-- VanithUI_Library.luau
-- Sidebar Tabs UI library matching the original "Eternal Nights" look.
-- Main tab layout preserved (avatar card + FPS/Ping card + changelog).
-- Components match styling: buttons, checkboxes (toggles), sliders.
-- API: CreateWindow, CreateTab/GetTab/ShowTab, AddLabel/AddButton/AddToggle/AddSlider,
--      Notify, SetHue, SetTitle.

local VanithUI = {}

--// Services
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")

--// Theme & defaults (faithful to original)
local DEFAULT_HUE = 0.55
local COLOR_BG        = Color3.fromRGB(18,18,18)
local COLOR_PANEL     = Color3.fromRGB(25,25,25)
local COLOR_SIDEBAR   = Color3.fromRGB(15,15,15)
local COLOR_TEXT      = Color3.fromRGB(220,220,220)

local function themeFromHue(h)
    return Color3.fromHSV(h,1,1)
end

local function round(obj, r)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, r or 6)
    c.Parent = obj
    return c
end

local function getParentGui()
    local ok, ui = pcall(function()
        local f = gethui and gethui()
        if typeof(f) == "Instance" then return f end
        return CoreGui
    end)
    return ok and ui or CoreGui
end

local function getPingMs()
    -- Prefer Stats ping string (matches typical executor UIs)
    local ok, val = pcall(function()
        local item = Stats.Network.ServerStatsItem["Data Ping"]
        if not item then return nil end
        local s = item:GetValueString() -- "35 ms"
        local num = tonumber(string.match(s or "", "(%d+)"))
        return num
    end)
    if ok then return val end
    -- Fallback to LocalPlayer ping (ms)
    local lp = Players.LocalPlayer
    if lp and lp.GetNetworkPing then
        local p = lp:GetNetworkPing()
        return math.floor((p or 0)*1000 + 0.5)
    end
    return nil
end

--// Notifications (top-right stack)
local function createNotifier(root, accent)
    local holder = Instance.new("Frame")
    holder.Name = "Vanith_Notifications"
    holder.BackgroundTransparency = 1
    holder.Size = UDim2.new(0, 300, 1, 0)
    holder.Position = UDim2.new(1, -320, 0, 20)
    holder.ZIndex = 5
    holder.Parent = root

    local layout = Instance.new("UIListLayout")
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, 8)
    layout.Parent = holder

    local function notify(title, message, duration)
        local card = Instance.new("Frame")
        card.Size = UDim2.new(1,0,0,80)
        card.BackgroundColor3 = COLOR_PANEL
        card.BorderSizePixel = 0
        card.ZIndex = 6
        round(card, 8)
        card.Parent = holder

        local accentBar = Instance.new("Frame")
        accentBar.Size = UDim2.new(0,4,1,0)
        accentBar.BackgroundColor3 = accent
        accentBar.BorderSizePixel = 0
        accentBar.ZIndex = 7
        round(accentBar,8)
        accentBar.Parent = card

        local t = Instance.new("TextLabel")
        t.BackgroundTransparency = 1
        t.Font = Enum.Font.GothamBold
        t.TextSize = 16
        t.TextXAlignment = Enum.TextXAlignment.Left
        t.TextColor3 = accent
        t.Text = title
        t.ZIndex = 7
        t.Size = UDim2.new(1,-32,0,20)
        t.Position = UDim2.new(0,16,0,8)
        t.Parent = card

        local m = Instance.new("TextLabel")
        m.BackgroundTransparency = 1
        m.Font = Enum.Font.Gotham
        m.TextSize = 14
        m.TextXAlignment = Enum.TextXAlignment.Left
        m.TextYAlignment = Enum.TextYAlignment.Top
        m.TextWrapped = true
        m.TextColor3 = COLOR_TEXT
        m.Text = message
        m.ZIndex = 7
        m.Size = UDim2.new(1,-32,0,40)
        m.Position = UDim2.new(0,16,0,32)
        m.Parent = card

        task.delay(duration or 2, function()
            local tween = TweenService:Create(card, TweenInfo.new(0.25), {BackgroundTransparency = 1})
            tween:Play()
            tween.Completed:Connect(function()
                if card then card:Destroy() end
            end)
        end)
    end

    return notify
end

--// Component builders (match original style)
local Component = {}

function Component.Label(container, text, accent)
    local lbl = Instance.new("TextLabel")
    lbl.BackgroundTransparency = 1
    lbl.Font = Enum.Font.Gotham
    lbl.TextSize = 14
    lbl.TextColor3 = accent or COLOR_TEXT
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Text = text or ""
    lbl.Size = UDim2.new(1, -20, 0, 20)
    lbl.Position = UDim2.new(0, 10, 0, 0)
    lbl.Parent = container

    local spacer = Instance.new("Frame")
    spacer.BackgroundTransparency = 1
    spacer.Size = UDim2.new(1,0,0,24)
    spacer.Parent = container

    return lbl
end

function Component.Button(container, text, accent, callback)
    local btn = Instance.new("TextButton")
    btn.AutoButtonColor = true
    btn.Text = text or "Button"
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.TextColor3 = accent
    btn.BackgroundColor3 = COLOR_SIDEBAR
    btn.Size = UDim2.new(1, -20, 0, 30)
    btn.Position = UDim2.new(0, 10, 0, 0)
    round(btn, 6)
    btn.Parent = container

    btn.MouseButton1Click:Connect(function()
        if typeof(callback) == "function" then
            task.spawn(callback)
        end
    end)

    local spacer = Instance.new("Frame")
    spacer.BackgroundTransparency = 1
    spacer.Size = UDim2.new(1,0,0,34)
    spacer.Parent = container

    return btn
end

function Component.Toggle(container, text, accent, default, callback)
    -- Checkbox-style toggle (frame + small square on the right)
    local h = 30
    local frame = Instance.new("Frame")
    frame.BackgroundColor3 = COLOR_SIDEBAR
    frame.Size = UDim2.new(1,-20,0,h)
    frame.Position = UDim2.new(0,10,0,0)
    frame.BorderSizePixel = 0
    round(frame, 6)
    frame.Parent = container

    local box = Instance.new("TextButton")
    box.AutoButtonColor = false
    box.Text = ""
    box.Size = UDim2.new(0,24,0,24)
    box.Position = UDim2.new(1,-30,0,(h-24)/2)
    box.BackgroundColor3 = default and accent or COLOR_BG
    round(box,4)
    box.Parent = frame

    local mark = Instance.new("Frame")
    mark.Size = UDim2.new(1,0,1,0)
    mark.BackgroundColor3 = COLOR_BG
    mark.BackgroundTransparency = default and 1 or 0
    round(mark,4)
    mark.Parent = box

    local lbl = Instance.new("TextLabel")
    lbl.BackgroundTransparency = 1
    lbl.Text = text or "Toggle"
    lbl.Font = Enum.Font.Gotham
    lbl.TextSize = 14
    lbl.TextColor3 = accent
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Size = UDim2.new(1,-38,1,0)
    lbl.Position = UDim2.new(0,8,0,0)
    lbl.Parent = frame

    local state = not not default
    local function set(v)
        state = not not v
        box.BackgroundColor3 = state and accent or COLOR_BG
        mark.BackgroundTransparency = state and 1 or 0
        if typeof(callback) == "function" then callback(state) end
    end

    box.MouseButton1Click:Connect(function()
        set(not state)
    end)

    local spacer = Instance.new("Frame")
    spacer.BackgroundTransparency = 1
    spacer.Size = UDim2.new(1,0,0,36)
    spacer.Parent = container

    return {
        Instance = frame,
        Set = set,
        Get = function() return state end,
    }
end

function Component.Slider(container, text, accent, min, max, default, callback)
    min, max = min or 0, max or 100
    if default == nil then default = min end

    local frame = Instance.new("Frame")
    frame.BackgroundColor3 = COLOR_SIDEBAR
    frame.Size = UDim2.new(1,-20,0,40)
    frame.Position = UDim2.new(0,10,0,0)
    frame.BorderSizePixel = 0
    round(frame, 6)
    frame.Parent = container

    local lbl = Instance.new("TextLabel")
    lbl.BackgroundTransparency = 1
    lbl.Text = string.format("%s: %s", text or "Slider", tostring(default))
    lbl.Font = Enum.Font.Gotham
    lbl.TextSize = 14
    lbl.TextColor3 = accent
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Size = UDim2.new(1,-20,0,18)
    lbl.Position = UDim2.new(0,10,0,6)
    lbl.Parent = frame

    local bar = Instance.new("Frame")
    bar.BackgroundColor3 = COLOR_BG
    bar.BorderSizePixel = 0
    bar.Position = UDim2.new(0,10,0,26)
    bar.Size = UDim2.new(1,-20,0,8)
    round(bar, 4)
    bar.Parent = frame

    local fill = Instance.new("Frame")
    fill.BackgroundColor3 = accent
    fill.BorderSizePixel = 0
    fill.Size = UDim2.new((default-min)/(max-min),0,1,0)
    round(fill, 4)
    fill.Parent = bar

    local dragging = false
    local value = default
    local function setFromX(x)
        local rel = math.clamp((x - bar.AbsolutePosition.X) / (bar.AbsoluteSize.X), 0, 1)
        value = math.floor(min + (max - min)*rel + 0.5)
        fill.Size = UDim2.new(rel, 0, 1, 0)
        lbl.Text = string.format("%s: %s", text or "Slider", tostring(value))
        if typeof(callback) == "function" then callback(value) end
    end

    bar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            setFromX(input.Position.X)
        end
    end)
    bar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            setFromX(input.Position.X)
        end
    end)

    return {
        Instance = frame,
        Set = function(v)
            v = math.clamp(v, min, max)
            local rel = (v-min)/(max-min)
            fill.Size = UDim2.new(rel, 0, 1, 0)
            lbl.Text = string.format("%s: %s", text or "Slider", tostring(v))
            value = v
            if typeof(callback)=="function" then callback(value) end
        end,
        Get = function() return value end
    }
end

--// Tab wrapper
local function makeTabObj(name, button, pageScroll, accent)
    local Tab = {}
    function Tab:AddLabel(text) return Component.Label(pageScroll, text, accent) end
    function Tab:AddButton(text, cb) return Component.Button(pageScroll, text, accent, cb) end
    function Tab:AddToggle(text, def, cb) return Component.Toggle(pageScroll, text, accent, def, cb) end
    function Tab:AddSlider(text, mi, ma, de, cb) return Component.Slider(pageScroll, text, accent, mi, ma, de, cb) end
    function Tab:GetContainer() return pageScroll end
    function Tab:GetButton() return button end
    function Tab:GetName() return name end
    return Tab
end

--// CreateWindow
function VanithUI.CreateWindow(opts)
    opts = opts or {}
    local title = opts.Title or "Vanith | Eternal Nights"
    local width = (opts.Width or 650)
    local height = (opts.Height or 300)
    local hue = (opts.Hue ~= nil) and opts.Hue or DEFAULT_HUE
    local accent = themeFromHue(hue)
    local version = opts.Version or "v1.0.2"
    local onDiscord = opts.OnDiscord or function() end
    local onUnlockFPS = opts.OnUnlockFPS or function() end

    -- Root GUI
    local rootGui = Instance.new("ScreenGui")
    rootGui.Name = "VanithUI"
    rootGui.ResetOnSpawn = false
    rootGui.IgnoreGuiInset = true
    rootGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    rootGui.Parent = getParentGui()

    -- Main window
    local main = Instance.new("Frame")
    main.Name = "Window"
    main.Size = UDim2.new(0, width, 0, height)
    main.Position = UDim2.new(0.15, 0, 0.22, 0)
    main.BackgroundColor3 = COLOR_BG
    main.BorderSizePixel = 0
    round(main, 6)
    main.Parent = rootGui

    -- Top bar
    local top = Instance.new("Frame")
    top.Name = "TopBar"
    top.BackgroundTransparency = 1
    top.Size = UDim2.new(1,0,0,28)
    top.Parent = main

    local titleLbl = Instance.new("TextLabel")
    titleLbl.BackgroundTransparency = 1
    titleLbl.Text = title
    titleLbl.Font = Enum.Font.GothamBold
    titleLbl.TextSize = 16
    titleLbl.TextColor3 = accent
    titleLbl.Position = UDim2.new(0, -60, 0, 0)
    titleLbl.Size = UDim2.new(0, 320, 1, 0)
    titleLbl.Parent = top

    local btnMin = Instance.new("TextButton")
    btnMin.Text = "_"
    btnMin.Font = Enum.Font.GothamBold
    btnMin.TextSize = 20
    btnMin.BackgroundTransparency = 1
    btnMin.TextColor3 = accent
    btnMin.Size = UDim2.new(0,28,0,28)
    btnMin.Position = UDim2.new(1,-60,0,0)
    btnMin.Parent = top

    local btnClose = Instance.new("TextButton")
    btnClose.Text = "X"
    btnClose.Font = Enum.Font.GothamBold
    btnClose.TextSize = 18
    btnClose.BackgroundTransparency = 1
    btnClose.TextColor3 = accent
    btnClose.Size = UDim2.new(0,28,0,28)
    btnClose.Position = UDim2.new(1,-32,0,0)
    btnClose.Parent = top

    -- Drag
    do
        local dragging, dragInput, dragStart, startPos
        top.InputBegan:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging, dragStart, startPos = true, i.Position, main.Position
                i.Changed:Connect(function()
                    if i.UserInputState == Enum.UserInputState.End then dragging = false end
                end)
            end
        end)
        top.InputChanged:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseMovement then dragInput = i end
        end)
        UserInputService.InputChanged:Connect(function(i)
            if dragging and i == dragInput then
                local delta = i.Position - dragStart
                main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
    end

    -- Minimize
    local minimized, mini
    btnMin.MouseButton1Click:Connect(function()
        if minimized then
            minimized = false
            if mini then mini:Destroy() end
            main.Visible = true
            btnMin.Text = "_"
            return
        end
        minimized = true
        main.Visible = false

        mini = Instance.new("Frame")
        mini.Name = "Mini"
        mini.Size = UDim2.new(0,50,0,50)
        mini.Position = UDim2.new(0.15, 0, 0.22, 0)
        mini.BackgroundColor3 = COLOR_BG
        mini.BorderSizePixel = 0
        round(mini,6)
        mini.Parent = rootGui

        local icon = Instance.new("TextLabel")
        icon.BackgroundTransparency = 1
        icon.Text = "❄️"
        icon.Font = Enum.Font.GothamBold
        icon.TextSize = 28
        icon.TextColor3 = accent
        icon.Size = UDim2.new(1,0,1,0)
        icon.Parent = mini

        local dragging, dragInput, dragStart, startPos, tapped = false, nil, nil, nil, false
        mini.InputBegan:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true; tapped = true
                dragStart = i.Position; startPos = mini.Position
                i.Changed:Connect(function()
                    if i.UserInputState == Enum.UserInputState.End then dragging = false end
                end)
            end
        end)
        mini.InputChanged:Connect(function(i)
            if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
                tapped = false
                local delta = i.Position - dragStart
                mini.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
        mini.InputEnded:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseButton1 and tapped then
                minimized = false
                if mini then mini:Destroy() end
                main.Visible = true
                btnMin.Text = "_"
            end
        end)
        btnMin.Text = "⬆"
    end)

    -- Close
    btnClose.MouseButton1Click:Connect(function() rootGui:Destroy() end)

    -- ===== Layout: Sidebar + Content =====
    local sidebar = Instance.new("Frame")
    sidebar.Name = "Sidebar"
    sidebar.Size = UDim2.new(0,100,1,-28)
    sidebar.Position = UDim2.new(0,0,0,28)
    sidebar.BackgroundColor3 = COLOR_SIDEBAR
    sidebar.BorderSizePixel = 0
    round(sidebar,6)
    sidebar.Parent = main

    local sbList = Instance.new("UIListLayout")
    sbList.Padding = UDim.new(0,6)
    sbList.FillDirection = Enum.FillDirection.Vertical
    sbList.SortOrder = Enum.SortOrder.LayoutOrder
    sbList.HorizontalAlignment = Enum.HorizontalAlignment.Center
    sbList.Parent = sidebar

    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1,-100,1,-28)
    content.Position = UDim2.new(0,100,0,28)
    content.BackgroundColor3 = COLOR_PANEL
    content.BorderSizePixel = 0
    round(content,6)
    content.Parent = main

    local pages = {}   -- [name] = frame
    local buttons = {} -- [name] = button
    local tabs = {}    -- [name] = Tab object
    local active = nil

    local function showPage(name)
        for n, fr in pairs(pages) do
            fr.Visible = (n == name)
        end
        for n, btn in pairs(buttons) do
            btn.TextColor3 = (n == name) and accent or COLOR_TEXT
            btn.BackgroundColor3 = (n == name) and COLOR_PANEL or Color3.fromRGB(22,22,22)
        end
        active = name
    end

    local function createSidebarButton(name)
        local b = Instance.new("TextButton")
        b.Name = name .. "_Tab"
        b.Text = name
        b.Font = Enum.Font.Gotham
        b.TextSize = 16
        b.TextColor3 = COLOR_TEXT
        b.AutoButtonColor = true
        b.Size = UDim2.new(1,-12,0,32)
        b.BackgroundColor3 = Color3.fromRGB(22,22,22)
        round(b,6)
        b.Parent = sidebar
        return b
    end

    local function createPage(name)
        local page = Instance.new("Frame")
        page.Name = name .. "_Page"
        page.Size = UDim2.new(1,0,1,0)
        page.BackgroundTransparency = 1
        page.Visible = false
        page.Parent = content

        local scroll = Instance.new("ScrollingFrame")
        scroll.BackgroundTransparency = 1
        scroll.Size = UDim2.new(1,0,1,0)
        scroll.CanvasSize = UDim2.new(0,0,0,0)
        scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
        scroll.ScrollBarThickness = 0
        scroll.Parent = page

        local padding = Instance.new("UIPadding")
        padding.PaddingLeft = UDim.new(0,12)
        padding.PaddingTop = UDim.new(0,12)
        padding.PaddingRight = UDim.new(0,12) -- UDim required
        padding.PaddingBottom = UDim.new(0,12)
        padding.Parent = scroll

        local list = Instance.new("UIListLayout")
        list.SortOrder = Enum.SortOrder.LayoutOrder
        list.Padding = UDim.new(0,12)
        list.Parent = scroll

        -- Main page should not scroll visually
        if name == "Main" then
            scroll.ScrollingEnabled = false
            scroll.ScrollBarImageTransparency = 1
        else
            scroll.ScrollingEnabled = true
            scroll.ScrollBarImageTransparency = 1
        end

        return page, scroll
    end

    local function addTab(name)
        if pages[name] then return tabs[name] end
        local page, scroll = createPage(name)
        local btn = createSidebarButton(name)
        buttons[name] = btn
        pages[name] = page

        btn.MouseButton1Click:Connect(function()
            showPage(name)
        end)

        local tabObj = makeTabObj(name, btn, scroll, accent)
        tabs[name] = tabObj
        return tabObj
    end

    -- === MAIN TAB (avatar + metrics + changelog) ===
    local mainTab = addTab("Main")
    do
        local scroll = mainTab:GetContainer()

        -- Header (left)
        local header = Instance.new("Frame")
        header.BackgroundColor3 = COLOR_SIDEBAR
        header.BorderSizePixel = 0
        header.Size = UDim2.new(1, -0, 0, 110)
        round(header, 8)
        header.Parent = scroll

        local avatar = Instance.new("ImageLabel")
        avatar.BackgroundTransparency = 1
        avatar.Size = UDim2.new(0, 64, 0, 64)
        avatar.Position = UDim2.new(0, 16, 0, 16)
        round(avatar, 32)
        avatar.Parent = header
        task.spawn(function()
            local p = Players.LocalPlayer
            local img = Players:GetUserThumbnailAsync(p.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
            avatar.Image = img
        end)

        local nameLbl = Instance.new("TextLabel")
        nameLbl.BackgroundTransparency = 1
        nameLbl.Font = Enum.Font.GothamBold
        nameLbl.TextSize = 20
        nameLbl.TextXAlignment = Enum.TextXAlignment.Left
        nameLbl.TextColor3 = accent
        nameLbl.Text = Players.LocalPlayer.Name
        nameLbl.Position = UDim2.new(0, 96, 0, 16)
        nameLbl.Size = UDim2.new(0, 240, 0, 24)
        nameLbl.Parent = header

        local verLbl = Instance.new("TextLabel")
        verLbl.BackgroundTransparency = 1
        verLbl.Font = Enum.Font.Gotham
        verLbl.TextSize = 14
        verLbl.TextXAlignment = Enum.TextXAlignment.Left
        verLbl.TextColor3 = accent
        verLbl.Text = "Version: "..tostring(version)
        verLbl.Position = UDim2.new(0, 96, 0, 44)
        verLbl.Size = UDim2.new(0, 240, 0, 18)
        verLbl.Parent = header

        local joinBtn = Instance.new("TextButton")
        joinBtn.Text = "Join Discord"
        joinBtn.Font = Enum.Font.GothamBold
        joinBtn.TextSize = 16
        joinBtn.TextColor3 = accent
        joinBtn.BackgroundColor3 = COLOR_SIDEBAR
        joinBtn.Size = UDim2.new(0, 180, 0, 30)
        joinBtn.Position = UDim2.new(0, 96, 0, 74)
        round(joinBtn, 6)
        joinBtn.Parent = header
        joinBtn.MouseButton1Click:Connect(function()
            onDiscord()
        end)

        -- Metrics (right)
        local metrics = Instance.new("Frame")
        metrics.BackgroundColor3 = COLOR_SIDEBAR
        metrics.BorderSizePixel = 0
        metrics.Size = UDim2.new(1, -0, 0, 110)
        round(metrics, 8)
        metrics.Parent = scroll

        local fpsLbl = Instance.new("TextLabel")
        fpsLbl.BackgroundTransparency = 1
        fpsLbl.Font = Enum.Font.Gotham
        fpsLbl.TextSize = 16
        fpsLbl.TextColor3 = accent
        fpsLbl.TextXAlignment = Enum.TextXAlignment.Left
        fpsLbl.Text = "FPS: —"
        fpsLbl.Position = UDim2.new(0, 10, 0, 20)
        fpsLbl.Size = UDim2.new(0, 200, 0, 20)
        fpsLbl.Parent = metrics

        local pingLbl = fpsLbl:Clone()
        pingLbl.Text = "Ping: —"
        pingLbl.Position = UDim2.new(0, 10, 0, 48)
        pingLbl.Parent = metrics

        local unlockBtn = Instance.new("TextButton")
        unlockBtn.Text = "Unlock FPS"
        unlockBtn.Font = Enum.Font.GothamBold
        unlockBtn.TextSize = 16
        unlockBtn.TextColor3 = accent
        unlockBtn.BackgroundColor3 = COLOR_SIDEBAR
        unlockBtn.Size = UDim2.new(0, 160, 0, 30)
        unlockBtn.Position = UDim2.new(1, -170, 0, 74)
        round(unlockBtn, 6)
        unlockBtn.Parent = metrics
        unlockBtn.MouseButton1Click:Connect(function()
            onUnlockFPS()
        end)

        -- Changelog block
        local changelog = Instance.new("TextLabel")
        changelog.BackgroundColor3 = COLOR_SIDEBAR
        changelog.BorderSizePixel = 0
        changelog.Font = Enum.Font.Gotham
        changelog.TextSize = 14
        changelog.TextColor3 = accent
        changelog.TextXAlignment = Enum.TextXAlignment.Left
        changelog.TextYAlignment = Enum.TextYAlignment.Top
        changelog.TextWrapped = true
        changelog.Size = UDim2.new(1, 0, 0, 120)
        changelog.Text = table.concat({
            "Changelog (UI Library Main Page):",
            "- Sidebar Tabs (Main + your custom tabs)",
            "- FPS & Ping metrics (live)",
            "- Minimize / Close / Drag",
            "- Components API per-Tab (Label, Button, Toggle, Slider)",
        }, "\n")
        round(changelog, 8)
        changelog.Parent = scroll

        -- Live metrics
        local fpsSmoothed = 60
        local last = tick()
        RunService.Heartbeat:Connect(function()
            local now = tick()
            local dt = now - last
            last = now
            local inst = (dt > 0) and (1/dt) or 60
            fpsSmoothed = fpsSmoothed * 0.9 + inst * 0.1
            fpsLbl.Text = ("FPS: %d"):format(math.floor(fpsSmoothed + 0.5))
        end)

        task.spawn(function()
            while rootGui.Parent do
                local p = getPingMs()
                pingLbl.Text = p and ("Ping: %d ms"):format(p) or "Ping: —"
                task.wait(0.5)
            end
        end)
    end

    -- Default empty tabs
    addTab("ESP")
    addTab("Misc")
    addTab("Teleport")

    -- Activate Main initially
    showPage("Main")

    -- Public API
    local notify = createNotifier(rootGui, accent)

    local window = {}

    function window:Notify(title, msg, dur) notify(title, msg, dur) end
    function window:SetHue(newHue)
        newHue = tonumber(newHue) or DEFAULT_HUE
        newHue = math.clamp(newHue, 0, 1)
        local newAccent = themeFromHue(newHue)
        accent = newAccent
        titleLbl.TextColor3 = accent
        btnMin.TextColor3 = accent
        btnClose.TextColor3 = accent
        -- update highlighted tab button
        for n, btn in pairs(buttons) do
            btn.TextColor3 = (n == active) and accent or COLOR_TEXT
        end
    end
    function window:SetTitle(newTitle)
        newTitle = tostring(newTitle or "")
        titleLbl.Text = newTitle
    end

    function window:GetRoot() return rootGui end
    function window:GetSidebar() return sidebar end
    function window:GetContent() return content end

    function window:GetTab(name) return tabs[name] end
    function window:CreateTab(name) return addTab(name) end

    -- Back-compat: add to Main when using window:AddX
    function window:AddLabel(text) return tabs.Main and tabs.Main:AddLabel(text) end
    function window:AddButton(text, cb) return tabs.Main and tabs.Main:AddButton(text, cb) end
    function window:AddToggle(text, def, cb) return tabs.Main and tabs.Main:AddToggle(text, def, cb) end
    function window:AddSlider(text, mi, ma, de, cb) return tabs.Main and tabs.Main:AddSlider(text, mi, ma, de, cb) end

    function window:ShowTab(name) if pages[name] then showPage(name) end end
    function window:Destroy() rootGui:Destroy() end

    -- Keybind: M to toggle
    UserInputService.InputBegan:Connect(function(i, g)
        if not g and i.KeyCode == Enum.KeyCode.M then
            rootGui.Enabled = not rootGui.Enabled
        end
    end)

    return window
end

return VanithUI
