-- Vanith UI Library (CoreGui, draggable, tabs, sliders, dropdowns, mobile support)
-- put this whole file on a raw URL and do:
-- local Vanith = loadstring(game:HttpGet("https://your.url/vanith.lua"))()

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")

local Vanith = {}

-- // Utils
local function create(className, props)
	local inst = Instance.new(className)
	for k, v in pairs(props or {}) do
		inst[k] = v
	end
	return inst
end

local function isTouch(t)
	return t == Enum.UserInputType.Touch
end

local function isMouse(t)
	return t == Enum.UserInputType.MouseButton1
		or t == Enum.UserInputType.MouseButton2
		or t == Enum.UserInputType.MouseButton3
end

local function clamp01(x)
	return math.clamp(x, 0, 1)
end

local function roundStep(value, minv, step)
	if not step or step <= 0 then
		return value
	end
	local n = (value - minv) / step
	return (math.floor(n + 0.5) * step) + minv
end

-- // Theme
local DEFAULT_THEME = {
	Accent  = Color3.fromRGB(170, 90, 255), -- purple
	BG0     = Color3.fromRGB(12, 12, 14),
	BG1     = Color3.fromRGB(16, 16, 19),
	BG2     = Color3.fromRGB(20, 20, 24),
	Stroke  = Color3.fromRGB(38, 38, 45),
	Text    = Color3.fromRGB(220, 220, 225),
	Muted   = Color3.fromRGB(125, 125, 135),
	DimText = Color3.fromRGB(75, 75, 85),
	Track   = Color3.fromRGB(30, 30, 36),
	Field   = Color3.fromRGB(26, 26, 31),
}

-- // Method tables
local WindowMethods  = {}
WindowMethods.__index = WindowMethods

local TabMethods     = {}
TabMethods.__index   = TabMethods

local SectionMethods = {}
SectionMethods.__index = SectionMethods

-- ==========================
-- WindowMethods helpers
-- ==========================

function WindowMethods:_bindTheme(inst, prop, key)
	self._themeBindings[#self._themeBindings + 1] = {
		inst = inst,
		prop = prop,
		key  = key,
	}
	inst[prop] = self.Theme[key]
	return inst
end

function WindowMethods:ApplyTheme()
	for _, b in ipairs(self._themeBindings) do
		if b.inst and b.inst.Parent then
			b.inst[b.prop] = self.Theme[b.key]
		end
	end
end

function WindowMethods:SetTheme(patch)
	for k, v in pairs(patch or {}) do
		self.Theme[k] = v
	end
	self:ApplyTheme()
end

function WindowMethods:SetAccent(color3)
	self.Theme.Accent = color3
	self:ApplyTheme()
end

function WindowMethods:Destroy()
	if self.Gui then
		self.Gui:Destroy()
	end
end

function WindowMethods:SetVisible(state)
	if self.Main then
		self.Main.Visible = state and true or false
	end
end

function WindowMethods:_enableDrag(dragHandle, dragTarget)
	local dragging = false
	local dragStart, startPos
	local activeInput

	local function update(input)
		if not dragging then return end
		local delta = input.Position - dragStart
		dragTarget.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end

	dragHandle.InputBegan:Connect(function(input)
		if isMouse(input.UserInputType) or isTouch(input.UserInputType) then
			dragging = true
			activeInput = input
			dragStart = input.Position
			startPos = dragTarget.Position

			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					activeInput = nil
				end
			end)
		end
	end)

	dragHandle.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement
			or input.UserInputType == Enum.UserInputType.Touch then
			activeInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == activeInput then
			update(input)
		end
	end)
end

-- Top weapon tabs (AK-47 / M4A1 ...)
function WindowMethods:CreateTopTab(text)
	local holder = self.TopTabsHolder

	local btn = create("TextButton", {
		AutoButtonColor = false,
		BackgroundTransparency = 1,
		Text = "",
		Size = UDim2.fromOffset(74, 34),
		Parent = holder,
	})

	local box = create("Frame", {
		BackgroundColor3 = self.Theme.BG1,
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 1, 0),
		Parent = btn,
	})
	create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = box})
	local st = create("UIStroke", {
		Thickness = 1,
		Transparency = 0.55,
		Parent = box,
	})
	st.Color = self.Theme.Stroke

	local label = create("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(8, 0),
		Size = UDim2.new(1, -16, 1, 0),
		Font = Enum.Font.GothamBold,
		Text = text,
		TextSize = 12,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = btn,
	})
	label.TextColor3 = self.Theme.DimText

	local underline = create("Frame", {
		BackgroundColor3 = self.Theme.Accent,
		BorderSizePixel = 0,
		Size = UDim2.new(0.25, 0, 0, 2),
		Position = UDim2.new(0.18, 0, 1, -2),
		Visible = false,
		Parent = btn,
	})

	local topTab = {
		Button = btn,
		Label = label,
		Underline = underline,
		Window = self,
	}

	table.insert(self.TopTabs, topTab)

	btn.MouseButton1Click:Connect(function()
		self:SetTopTab(topTab)
	end)

	if #self.TopTabs == 1 then
		self:SetTopTab(topTab)
	end

	return topTab
end

function WindowMethods:SetTopTab(tab)
	self.ActiveTopTab = tab
	for _, t in ipairs(self.TopTabs) do
		local active = (t == tab)
		t.Underline.Visible = active
		t.Label.TextColor3 = active and self.Theme.Accent or self.Theme.DimText
	end
end

-- Sidebar tabs
function WindowMethods:CreateTab(name, iconText)
	local btn = create("TextButton", {
		AutoButtonColor = false,
		BackgroundTransparency = 1,
		Text = "",
		Size = UDim2.new(1, -20, 0, 38),
		Parent = self.SideList,
	})

	local icon = create("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(6, 8),
		Size = UDim2.fromOffset(22, 22),
		Font = Enum.Font.GothamBold,
		Text = iconText or "•",
		TextSize = 14,
		Parent = btn,
	})
	self:_bindTheme(icon, "TextColor3", "DimText")

	local label = create("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(32, 8),
		Size = UDim2.new(1, -38, 0, 22),
		Font = Enum.Font.GothamBold,
		Text = name,
		TextSize = 13,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = btn,
	})
	self:_bindTheme(label, "TextColor3", "Muted")

	local activeBar = create("Frame", {
		BorderSizePixel = 0,
		Size = UDim2.new(0, 2, 0.64, 0),
		Position = UDim2.new(1, -2, 0.18, 0),
		Visible = false,
		Parent = btn,
	})
	self:_bindTheme(activeBar, "BackgroundColor3", "Accent")

	local page = create("ScrollingFrame", {
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 1, 0),
		CanvasSize = UDim2.new(0, 0, 0, 0),
		ScrollBarThickness = 2,
		ScrollingDirection = Enum.ScrollingDirection.Y,
		Visible = false,
		Parent = self.Pages,
	})
	self:_bindTheme(page, "ScrollBarImageColor3", "Accent")

	local layout = create("UIListLayout", {
		Padding = UDim.new(0, 12),
		SortOrder = Enum.SortOrder.LayoutOrder,
		Parent = page,
	})
	create("UIPadding", {
		PaddingTop = UDim.new(0, 2),
		PaddingLeft = UDim.new(0, 0),
		PaddingRight = UDim.new(0, 0),
		PaddingBottom = UDim.new(0, 14),
		Parent = page,
	})

	layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		page.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 10)
	end)

	local tab = setmetatable({
		Window = self,
		Name = name,
		Button = btn,
		Icon = icon,
		Label = label,
		ActiveBar = activeBar,
		Page = page,
	}, TabMethods)

	btn.MouseButton1Click:Connect(function()
		self:SelectTab(tab)
	end)

	table.insert(self.Tabs, tab)

	if #self.Tabs == 1 then
		self:SelectTab(tab)
	end

	return tab
end

function WindowMethods:SelectTab(tab)
	self.ActiveTab = tab
	for _, t in ipairs(self.Tabs) do
		local active = (t == tab)
		t.Page.Visible = active
		t.ActiveBar.Visible = active
		t.Icon.TextColor3 = active and self.Theme.Accent or self.Theme.DimText
		t.Label.TextColor3 = active and self.Theme.Text or self.Theme.Muted
	end
end

-- ==========================
-- TabMethods
-- ==========================

function TabMethods:Select()
	self.Window:SelectTab(self)
end

function TabMethods:CreateSection(title)
	local window = self.Window
	local page = self.Page

	local frame = create("Frame", {
		BorderSizePixel = 0,
		Size = UDim2.new(1, -0, 0, 180),
		AutomaticSize = Enum.AutomaticSize.Y,
		Parent = page,
	})
	window:_bindTheme(frame, "BackgroundColor3", "BG1")
	create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = frame})
	local st = create("UIStroke", {
		Thickness = 1,
		Transparency = 0.25,
		Parent = frame,
	})
	window:_bindTheme(st, "Color", "Stroke")

	local header = create("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(12, 10),
		Size = UDim2.new(1, -24, 0, 18),
		Font = Enum.Font.GothamBold,
		Text = title,
		TextSize = 12,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = frame,
	})
	window:_bindTheme(header, "TextColor3", "Accent")

	local inner = create("Frame", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(0, 34),
		Size = UDim2.new(1, 0, 1, -34),
		AutomaticSize = Enum.AutomaticSize.Y,
		Parent = frame,
	})

	local il = create("UIListLayout", {
		Padding = UDim.new(0, 10),
		SortOrder = Enum.SortOrder.LayoutOrder,
		Parent = inner,
	})
	create("UIPadding", {
		PaddingTop = UDim.new(0, 6),
		PaddingLeft = UDim.new(0, 12),
		PaddingRight = UDim.new(0, 12),
		PaddingBottom = UDim.new(0, 10),
		Parent = inner,
	})

	local section = setmetatable({
		Window = window,
		Frame = frame,
		Inner = inner,
		List  = il,
	}, SectionMethods)

	return section
end

-- ==========================
-- SectionMethods Controls
-- ==========================

function SectionMethods:CreateSlider(cfg)
	local window = self.Window
	local inner  = self.Inner

	cfg = cfg or {}
	local minv = cfg.Min or 0
	local maxv = cfg.Max or 100
	local step = cfg.Step or 1
	local value = math.clamp(cfg.Default or minv, minv, maxv)
	value = roundStep(value, minv, step)

	local row = create("Frame", {
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 54),
		Parent = inner,
	})

	local left = create("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.new(0.6, 0, 0, 18),
		Font = Enum.Font.Gotham,
		Text = cfg.Name or "Slider",
		TextSize = 12,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = row,
	})
	window:_bindTheme(left, "TextColor3", "DimText")

	local right = create("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.new(0.6, 0, 0, 0),
		Size = UDim2.new(0.4, 0, 0, 18),
		Font = Enum.Font.GothamBold,
		Text = tostring(value),
		TextSize = 12,
		TextXAlignment = Enum.TextXAlignment.Right,
		Parent = row,
	})
	window:_bindTheme(right, "TextColor3", "Accent")

	local track = create("Frame", {
		BorderSizePixel = 0,
		Position = UDim2.fromOffset(0, 26),
		Size = UDim2.new(1, 0, 0, 4),
		Parent = row,
	})
	window:_bindTheme(track, "BackgroundColor3", "Track")
	create("UICorner", {CornerRadius = UDim.new(0, 2), Parent = track})

	local fill = create("Frame", {
		BorderSizePixel = 0,
		Size = UDim2.new(0, 0, 1, 0),
		Parent = track,
	})
	window:_bindTheme(fill, "BackgroundColor3", "Accent")
	create("UICorner", {CornerRadius = UDim.new(0, 2), Parent = fill})

	local knob = create("Frame", {
		BorderSizePixel = 0,
		Size = UDim2.fromOffset(10, 10),
		Parent = track,
	})
	window:_bindTheme(knob, "BackgroundColor3", "Muted")
	create("UICorner", {CornerRadius = UDim.new(0, 2), Parent = knob})

	local function setVisual(v)
		local ratio = (v - minv) / (maxv - minv)
		ratio = clamp01(ratio)
		fill.Size = UDim2.new(ratio, 0, 1, 0)
		knob.Position = UDim2.new(ratio, -5, 0.5, -5)
		if cfg.Format then
			right.Text = cfg.Format(v)
		else
			right.Text = tostring(v)
		end
	end

	local function setValue(v, fromUser)
		v = math.clamp(v, minv, maxv)
		v = roundStep(v, minv, step)
		value = v
		setVisual(v)
		if fromUser and cfg.Callback then
			task.spawn(cfg.Callback, v)
		end
	end

	setVisual(value)

	local dragging = false
	local activeInput

	local function valueFromInput(input)
		local x = input.Position.X - track.AbsolutePosition.X
		local ratio = clamp01(x / math.max(track.AbsoluteSize.X, 1))
		return minv + ratio * (maxv - minv)
	end

	local function begin(input)
		dragging = true
		activeInput = input
		knob.BackgroundColor3 = window.Theme.Accent
		setValue(valueFromInput(input), true)

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
				activeInput = nil
				knob.BackgroundColor3 = window.Theme.Muted
			end
		end)
	end

	track.InputBegan:Connect(function(input)
		if isMouse(input.UserInputType) or isTouch(input.UserInputType) then
			begin(input)
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if dragging and input == activeInput then
			setValue(valueFromInput(input), true)
		end
	end)

	local sliderObj = {}

	function sliderObj:Set(v)
		setValue(v, false)
	end

	function sliderObj:Get()
		return value
	end

	return sliderObj
end

function SectionMethods:CreateDropdown(cfg)
	local window = self.Window
	local inner  = self.Inner

	cfg = cfg or {}
	local options = cfg.Options or {}
	local current = cfg.Default or options[1] or "None"
	local open = false

	local wrap = create("Frame", {
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 30),
		AutomaticSize = Enum.AutomaticSize.Y,
		Parent = inner,
	})

	local head = create("TextButton", {
		AutoButtonColor = false,
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 0, 24),
		Text = "",
		Parent = wrap,
	})
	window:_bindTheme(head, "BackgroundColor3", "Field")
	create("UICorner", {CornerRadius = UDim.new(0, 3), Parent = head})
	local st = create("UIStroke", {
		Thickness = 1,
		Transparency = 0.55,
		Parent = head,
	})
	window:_bindTheme(st, "Color", "Stroke")

	local nameLbl = create("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(10, 0),
		Size = UDim2.new(0.6, -10, 1, 0),
		Font = Enum.Font.Gotham,
		Text = cfg.Name or "Dropdown",
		TextSize = 12,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = head,
	})
	window:_bindTheme(nameLbl, "TextColor3", "DimText")

	local valLbl = create("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.new(0.6, 0, 0, 0),
		Size = UDim2.new(0.4, -26, 1, 0),
		Font = Enum.Font.GothamBold,
		Text = tostring(current),
		TextSize = 12,
		TextXAlignment = Enum.TextXAlignment.Right,
		Parent = head,
	})
	window:_bindTheme(valLbl, "TextColor3", "Text")

	local arrow = create("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.new(1, -22, 0, 0),
		Size = UDim2.fromOffset(20, 24),
		Font = Enum.Font.GothamBold,
		Text = "▾",
		TextSize = 14,
		Parent = head,
	})
	window:_bindTheme(arrow, "TextColor3", "Muted")

	local listWrap = create("Frame", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(0, 28),
		Size = UDim2.new(1, 0, 0, 0),
		ClipsDescendants = true,
		Parent = wrap,
	})

	local listBg = create("Frame", {
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 0, 0),
		Parent = listWrap,
	})
	window:_bindTheme(listBg, "BackgroundColor3", "Field")
	create("UICorner", {CornerRadius = UDim.new(0, 3), Parent = listBg})
	local st2 = create("UIStroke", {
		Thickness = 1,
		Transparency = 0.55,
		Parent = listBg,
	})
	window:_bindTheme(st2, "Color", "Stroke")

	local list = create("UIListLayout", {
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 6),
		Parent = listBg,
	})
	create("UIPadding", {
		PaddingTop = UDim.new(0, 8),
		PaddingLeft = UDim.new(0, 10),
		PaddingRight = UDim.new(0, 10),
		PaddingBottom = UDim.new(0, 8),
		Parent = listBg,
	})

	local function rebuild()
		for _, child in ipairs(listBg:GetChildren()) do
			if child:IsA("TextButton") then
				child:Destroy()
			end
		end

		for _, opt in ipairs(options) do
			local b = create("TextButton", {
				AutoButtonColor = false,
				BackgroundTransparency = 1,
				Size = UDim2.new(1, 0, 0, 20),
				Font = Enum.Font.Gotham,
				Text = tostring(opt),
				TextSize = 12,
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = listBg,
			})
			b.TextColor3 = (opt == current) and window.Theme.Accent or window.Theme.Text

			b.MouseButton1Click:Connect(function()
				current = opt
				valLbl.Text = tostring(current)
				if cfg.Callback then
					task.spawn(cfg.Callback, current)
				end
				rebuild()
				open = false
				listWrap:TweenSize(UDim2.new(1, 0, 0, 0), "Out", "Quad", 0.14, true)
				listBg:TweenSize(UDim2.new(1, 0, 0, 0), "Out", "Quad", 0.14, true)
				arrow.Text = "▾"
			end)
		end
	end

	rebuild()

	local function setOpen(state)
		open = state
		if open then
			task.wait()
			local h = list.AbsoluteContentSize.Y + 16
			listWrap:TweenSize(UDim2.new(1, 0, 0, h), "Out", "Quad", 0.14, true)
			listBg:TweenSize(UDim2.new(1, 0, 0, h), "Out", "Quad", 0.14, true)
			arrow.Text = "▴"
		else
			listWrap:TweenSize(UDim2.new(1, 0, 0, 0), "Out", "Quad", 0.14, true)
			listBg:TweenSize(UDim2.new(1, 0, 0, 0), "Out", "Quad", 0.14, true)
			arrow.Text = "▾"
		end
	end

	head.MouseButton1Click:Connect(function()
		setOpen(not open)
	end)

	local ddObj = {}

	function ddObj:SetOptions(newOptions)
		options = newOptions or {}
		if not table.find(options, current) then
			current = options[1] or "None"
			valLbl.Text = tostring(current)
		end
		rebuild()
		setOpen(false)
	end

	function ddObj:Set(v)
		if table.find(options, v) then
			current = v
			valLbl.Text = tostring(current)
			rebuild()
		end
	end

	function ddObj:Get()
		return current
	end

	return ddObj
end

function SectionMethods:CreateToggle(cfg)
	local window = self.Window
	local inner  = self.Inner

	cfg = cfg or {}
	local state = cfg.Default and true or false

	local row = create("TextButton", {
		AutoButtonColor = false,
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 24),
		Text = "",
		Parent = inner,
	})

	local label = create("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -70, 1, 0),
		Font = Enum.Font.Gotham,
		Text = cfg.Name or "Toggle",
		TextSize = 12,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = row,
	})
	window:_bindTheme(label, "TextColor3", "Text")

	local sw = create("Frame", {
		BorderSizePixel = 0,
		Position = UDim2.new(1, -52, 0.5, -9),
		Size = UDim2.fromOffset(44, 18),
		Parent = row,
	})
	window:_bindTheme(sw, "BackgroundColor3", "Field")
	create("UICorner", {CornerRadius = UDim.new(0, 3), Parent = sw})
	local st = create("UIStroke", {
		Thickness = 1,
		Transparency = 0.55,
		Parent = sw,
	})
	window:_bindTheme(st, "Color", "Stroke")

	local fill = create("Frame", {BorderSizePixel = 0, Parent = sw})
	create("UICorner", {CornerRadius = UDim.new(0, 2), Parent = fill})

	local function render()
		if state then
			fill.Size = UDim2.fromOffset(28, 14)
			fill.Position = UDim2.fromOffset(2, 2)
			fill.BackgroundColor3 = window.Theme.Accent
		else
			fill.Size = UDim2.fromOffset(14, 14)
			fill.Position = UDim2.fromOffset(2, 2)
			fill.BackgroundColor3 = window.Theme.Track
		end
	end

	render()

	row.MouseButton1Click:Connect(function()
		state = not state
		render()
		if cfg.Callback then
			task.spawn(cfg.Callback, state)
		end
	end)

	local tObj = {}
	function tObj:Set(v) state = v and true or false; render() end
	function tObj:Get() return state end
	return tObj
end

function SectionMethods:CreateButton(cfg)
	local window = self.Window
	local inner  = self.Inner
	cfg = cfg or {}

	local btn = create("TextButton", {
		AutoButtonColor = false,
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 0, 24),
		Font = Enum.Font.GothamBold,
		Text = cfg.Name or "Button",
		TextSize = 12,
		Parent = inner,
	})
	window:_bindTheme(btn, "BackgroundColor3", "Field")
	window:_bindTheme(btn, "TextColor3", "Text")
	create("UICorner", {CornerRadius = UDim.new(0, 3), Parent = btn})
	local st = create("UIStroke", {
		Thickness = 1,
		Transparency = 0.55,
		Parent = btn,
	})
	window:_bindTheme(st, "Color", "Stroke")

	btn.MouseButton1Click:Connect(function()
		if cfg.Callback then task.spawn(cfg.Callback) end
	end)

	return btn
end

function SectionMethods:CreateTextbox(cfg)
	local window = self.Window
	local inner  = self.Inner
	cfg = cfg or {}

	local box = create("TextBox", {
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 0, 24),
		Font = Enum.Font.Gotham,
		Text = cfg.Default or "",
		PlaceholderText = cfg.Placeholder or "Enter text...",
		TextSize = 12,
		ClearTextOnFocus = false,
		Parent = inner,
	})
	window:_bindTheme(box, "BackgroundColor3", "Field")
	window:_bindTheme(box, "TextColor3", "Text")
	box.PlaceholderColor3 = window.Theme.Muted
	create("UICorner", {CornerRadius = UDim.new(0, 3), Parent = box})
	local st = create("UIStroke", {
		Thickness = 1,
		Transparency = 0.55,
		Parent = box,
	})
	window:_bindTheme(st, "Color", "Stroke")

	box.FocusLost:Connect(function(enterPressed)
		if cfg.Callback then task.spawn(cfg.Callback, box.Text, enterPressed) end
	end)

	return box
end

-- ==========================
-- Vanith:CreateWindow
-- ==========================

function Vanith:CreateWindow(cfg)
	cfg = cfg or {}

	-- clone theme
	local theme = {}
	for k, v in pairs(DEFAULT_THEME) do theme[k] = v end
	for k, v in pairs(cfg.Theme or {}) do theme[k] = v end

	-- resolve parent (CoreGui by default)
	local parent = cfg.Parent
	if not parent then
		local ok, cg = pcall(function()
			if gethui then
				return gethui()
			end
			return game:GetService("CoreGui")
		end)
		if ok and cg then
			parent = cg
		else
			local lp = Players.LocalPlayer
			if lp then
				parent = lp:WaitForChild("PlayerGui")
			end
		end
	end

	local window = setmetatable({
		Theme = theme,
		_themeBindings = {},
		Tabs = {},
		TopTabs = {},
	}, WindowMethods)

	local gui = create("ScreenGui", {
		Name = cfg.Name or "VanithUI",
		ResetOnSpawn = false,
		IgnoreGuiInset = true,
		Parent = parent,
	})
	window.Gui = gui

	local main = create("Frame", {
		Name = "Main",
		Size = cfg.Size or UDim2.fromOffset(649, 417),
		Position = cfg.Position or UDim2.fromScale(0.5, 0.5),
		AnchorPoint = Vector2.new(0.5, 0.5),
		BorderSizePixel = 0,
		Parent = gui,
	})
	window.Main = main
	window:_bindTheme(main, "BackgroundColor3", "BG0")
	create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = main})
	local ms = create("UIStroke", {Thickness = 1, Transparency = 0.2, Parent = main})
	window:_bindTheme(ms, "Color", "Stroke")

	-- Top bar
	local top = create("Frame", {
		Name = "TopBar",
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 0, 54),
		Parent = main,
	})
	window.TopBar = top
	window:_bindTheme(top, "BackgroundColor3", "BG2")
	create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = top})

	create("Frame", {
		BackgroundColor3 = theme.BG2,
		BorderSizePixel = 0,
		Position = UDim2.new(0, 0, 0, 44),
		Size = UDim2.new(1, 0, 0, 20),
		Parent = top,
	})

	-- left box (title)
	local titleBox = create("Frame", {
		BorderSizePixel = 0,
		Position = UDim2.fromOffset(12, 10),
		Size = UDim2.fromOffset(140, 34),
		Parent = top,
	})
	window:_bindTheme(titleBox, "BackgroundColor3", "BG1")
	create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = titleBox})
	local tbs = create("UIStroke", {Thickness = 1, Transparency = 0.55, Parent = titleBox})
	window:_bindTheme(tbs, "Color", "Stroke")

	local title = create("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(10, 6),
		Size = UDim2.new(1, -20, 1, -12),
		Font = Enum.Font.GothamBold,
		Text = cfg.Title or "Eternesus",
		TextSize = 15,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = titleBox,
	})
	window:_bindTheme(title, "TextColor3", "Accent")

	-- weapon tabs holder
	local tabsHolder = create("Frame", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(160, 10),
		Size = UDim2.new(1, -240, 1, -20),
		Parent = top,
	})
	window.TopTabsHolder = tabsHolder
	create("UIListLayout", {
		FillDirection = Enum.FillDirection.Horizontal,
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 8),
		Parent = tabsHolder,
	})

	-- right gear box
	local gearBox = create("Frame", {
		BorderSizePixel = 0,
		Position = UDim2.new(1, -52, 0, 10),
		Size = UDim2.fromOffset(40, 34),
		Parent = top,
	})
	window:_bindTheme(gearBox, "BackgroundColor3", "BG1")
	create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = gearBox})
	local gbs = create("UIStroke", {Thickness = 1, Transparency = 0.55, Parent = gearBox})
	window:_bindTheme(gbs, "Color", "Stroke")

	local gear = create("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.fromScale(1, 1),
		Font = Enum.Font.GothamBold,
		Text = "⚙",
		TextSize = 18,
		Parent = gearBox,
	})
	window:_bindTheme(gear, "TextColor3", "Accent")

	-- Sidebar
	local side = create("Frame", {
		Name = "Sidebar",
		BorderSizePixel = 0,
		Position = UDim2.fromOffset(12, 68),
		Size = UDim2.fromOffset(120, 337),
		Parent = main,
	})
	window.Sidebar = side
	window:_bindTheme(side, "BackgroundColor3", "BG2")
	create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = side})
	local ss = create("UIStroke", {Thickness = 1, Transparency = 0.25, Parent = side})
	window:_bindTheme(ss, "Color", "Stroke")

	local sideList = create("Frame", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(10, 14),
		Size = UDim2.new(1, -20, 1, -24),
		Parent = side,
	})
	window.SideList = sideList
	create("UIListLayout", {
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 6),
		Parent = sideList,
	})

	-- Content / pages
	local pages = create("Frame", {
		BackgroundTransparency = 1,
		Position = UDim2.fromOffset(146, 68),
		Size = UDim2.new(1, -158, 1, -80),
		Parent = main,
	})
	window.Pages = pages

	-- Drag
	if cfg.Draggable ~= false then
		window:_enableDrag(top, main)
	end

	-- Basic mobile scaling
	local uiScale = create("UIScale", {Parent = main})
	local cam = workspace.CurrentCamera
	if cam then
		local vp = cam.ViewportSize
		if vp.X < 900 then
			uiScale.Scale = math.clamp(vp.X / 900, 0.75, 1)
		end
	end

	return window
end

return Vanith
