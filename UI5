-- Vanith UI Library
-- usage:
-- local Vanith = loadstring(game:HttpGet("YOUR_URL_HERE"))()
-- local win = Vanith:CreateWindow({ Title = "Vanith" })

local Players          = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService     = game:GetService("TweenService")

local Vanith = {}

-- small helpers

local function New(className, props)
    local inst = Instance.new(className)
    if props then
        for k, v in pairs(props) do
            inst[k] = v
        end
    end
    return inst
end

local function IsMouse(t)
    return t == Enum.UserInputType.MouseButton1
        or t == Enum.UserInputType.MouseButton2
        or t == Enum.UserInputType.MouseButton3
end

local function IsTouch(t)
    return t == Enum.UserInputType.Touch
end

local function Clamp01(x)
    return math.clamp(x, 0, 1)
end

local function RoundStep(v, minv, step)
    if not step or step <= 0 then return v end
    local n = (v - minv) / step
    return (math.floor(n + 0.5) * step) + minv
end

local function PlayTween(inst, props, time)
    if not inst then return end
    time = time or 0.15
    local ok, tween = pcall(TweenService.Create, TweenService, inst, TweenInfo.new(time, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props)
    if ok and tween then
        tween:Play()
    end
end

-- default theme (dark, purple)
local DEFAULT_THEME = {
    Accent  = Color3.fromRGB(170, 90, 255),
    BG0     = Color3.fromRGB(4, 4, 6),
    BG1     = Color3.fromRGB(10, 10, 14),
    BG2     = Color3.fromRGB(14, 14, 18),
    Stroke  = Color3.fromRGB(40, 40, 50),
    Text    = Color3.fromRGB(230, 230, 238),
    Muted   = Color3.fromRGB(140, 140, 150),
    DimText = Color3.fromRGB(95, 95, 110),
    Track   = Color3.fromRGB(22, 22, 28),
    Field   = Color3.fromRGB(16, 16, 20),
}

local Window  = {}
Window.__index = Window

local Tab     = {}
Tab.__index   = Tab

local Section = {}
Section.__index = Section

---------------------------------------------------------------------
-- window helpers
---------------------------------------------------------------------

function Window:_track(inst, prop, key)
    table.insert(self._themeBindings, {inst = inst, prop = prop, key = key})
    inst[prop] = self.Theme[key]
    return inst
end

function Window:ApplyTheme()
    for _, b in ipairs(self._themeBindings) do
        if b.inst and b.inst.Parent then
            b.inst[b.prop] = self.Theme[b.key]
        end
    end
end

function Window:SetTheme(tbl)
    for k, v in pairs(tbl or {}) do
        self.Theme[k] = v
    end
    self:ApplyTheme()
end

function Window:SetAccent(color)
    self.Theme.Accent = color
    self:ApplyTheme()
end

function Window:SetVisible(state)
    if self.Main then
        self.Main.Visible = state and true or false
    end
end

function Window:Destroy()
    if self.Gui then
        self.Gui:Destroy()
    end
end

-- drag top bar
function Window:_enableDrag(handle, target)
    local dragging
    local dragStart
    local startPos
    local activeInput

    local function update(input)
        if not dragging then return end
        local posDelta = input.Position - dragStart
        target.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + posDelta.X,
            startPos.Y.Scale, startPos.Y.Offset + posDelta.Y
        )
    end

    handle.InputBegan:Connect(function(input)
        if IsMouse(input.UserInputType) or IsTouch(input.UserInputType) then
            dragging    = true
            activeInput = input
            dragStart   = input.Position
            startPos    = target.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging    = false
                    activeInput = nil
                end
            end)
        end
    end)

    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement
            or input.UserInputType == Enum.UserInputType.Touch then
            activeInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == activeInput then
            update(input)
        end
    end)
end

-- resize bottom right
function Window:_enableResize(handle, target)
    local minSize = Vector2.new(450, 350)

    local resizing
    local dragStart
    local startSize
    local activeInput

    local function update(input)
        if not resizing then return end
        local delta = input.Position - dragStart
        local newSize = Vector2.new(
            math.max(minSize.X, startSize.X + delta.X),
            math.max(minSize.Y, startSize.Y + delta.Y)
        )
        target.Size = UDim2.fromOffset(newSize.X, newSize.Y)
    end

    handle.InputBegan:Connect(function(input)
        if IsMouse(input.UserInputType) or IsTouch(input.UserInputType) then
            resizing    = true
            activeInput = input
            dragStart   = input.Position
            startSize   = Vector2.new(target.AbsoluteSize.X, target.AbsoluteSize.Y)

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    resizing    = false
                    activeInput = nil
                end
            end)
        end
    end)

    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement
            or input.UserInputType == Enum.UserInputType.Touch then
            activeInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == activeInput then
            update(input)
        end
    end)
end

-- internal: create a top-tab button (used per Tab)
function Window:_makeTopTabButton(text)
    local holder = self.TopTabsHolder

    local btn = New("TextButton", {
        AutoButtonColor = false,
        BackgroundTransparency = 1,
        Text = "",
        Size = UDim2.new(0, 0, 1, 0),
        AutomaticSize = Enum.AutomaticSize.X,
        Parent = holder,
        ZIndex = 3,
    })

    local label = New("TextLabel", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = text,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Center,
        Parent = btn,
        ZIndex = 3,
        TextColor3 = self.Theme.DimText,
    })

    local underline = New("Frame", {
        BorderSizePixel = 0,
        Size = UDim2.new(0.7, 0, 0, 2),
        Position = UDim2.new(0.15, 0, 1, -3),
        Parent = btn,
        Visible = false,
        ZIndex = 2,
        BackgroundColor3 = self.Theme.Accent,
    })

    local t = {Button = btn, Label = label, Underline = underline, Tab = nil}
    table.insert(self.TopTabs, t)
    return t
end

---------------------------------------------------------------------
-- left side tabs
---------------------------------------------------------------------

function Window:CreateTab(name)
    local row = New("TextButton", {
        AutoButtonColor = false,
        BackgroundTransparency = 1,
        Text = "",
        Size = UDim2.new(1, -20, 0, 38),
        Parent = self.SideList,
        ZIndex = 2,
    })

    local bg = New("Frame", {
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, 0),
        Parent = row,
        ZIndex = 1,
    })
    self:_track(bg, "BackgroundColor3", "BG2")

    local accent = New("Frame", {
        BorderSizePixel = 0,
        Size = UDim2.new(0, 2, 0.6, 0),
        Position = UDim2.new(0, 0, 0.2, 0),
        Parent = row,
        Visible = false,
        ZIndex = 2,
    })
    self:_track(accent, "BackgroundColor3", "Accent")

    local label = New("TextLabel", {
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(10, 8),
        Size = UDim2.new(1, -20, 0, 22),
        Font = Enum.Font.GothamBold,
        Text = name,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = row,
        ZIndex = 3,
    })
    self:_track(label, "TextColor3", "Muted")

    local page = New("Frame", {
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 1, 0),
        Visible = false,
        Parent = self.Pages,
        ZIndex = 1,
    })

    local tab = setmetatable({
        Window        = self,
        Name          = name,
        Row           = row,
        Label         = label,
        Accent        = accent,
        Bg            = bg,
        Page          = page,
        _sections     = {},
        _topTabs      = {},
        _activeTopTab = nil,
    }, Tab)

    row.MouseButton1Click:Connect(function()
        self:SelectTab(tab)
    end)

    table.insert(self.Tabs, tab)
    if #self.Tabs == 1 then
        self:SelectTab(tab)
    end

    return tab
end

function Window:SelectTab(tab)
    self.ActiveTab = tab

    for _, t in ipairs(self.Tabs) do
        local active = (t == tab)

        t.Page.Visible = active

        PlayTween(t.Bg, {BackgroundTransparency = active and 0 or 1}, 0.12)
        t.Accent.Visible = active
        PlayTween(t.Label, {TextColor3 = active and self.Theme.Text or self.Theme.Muted}, 0.12)

        for _, topTab in ipairs(t._topTabs) do
            topTab.Button.Visible = active
        end
    end

    if tab._activeTopTab then
        tab:SetTopTab(tab._activeTopTab)
    end
end

---------------------------------------------------------------------
-- tab methods (top-tabs + sections)
---------------------------------------------------------------------

function Tab:CreateTopTab(name)
    local win = self.Window
    local tt  = win:_makeTopTabButton(name)
    tt.Tab    = self

    table.insert(self._topTabs, tt)
    tt.Button.Visible = (win.ActiveTab == self)

    tt.Button.MouseButton1Click:Connect(function()
        self:SetTopTab(tt)
    end)

    if not self._activeTopTab then
        self:SetTopTab(tt)
    end

    return tt
end

function Tab:SetTopTab(tt)
    self._activeTopTab = tt
    local win = self.Window

    for _, other in ipairs(self._topTabs) do
        local active = (other == tt)
        other.Underline.Visible = active and (win.ActiveTab == self)
        PlayTween(other.Label, {
            TextColor3 = active and win.Theme.Accent or win.Theme.DimText
        }, 0.12)
    end
end

-- slot: "LeftTop", "LeftBottom", "RightTop", "RightBottom"
function Tab:CreateSection(title, slot)
    local win  = self.Window
    local page = self.Page

    local layout = {
        LeftTop = {
            Pos  = UDim2.new(0, 0, 0, 0),
            Size = UDim2.new(0.68, -6, 0, 190),
        },
        LeftBottom = {
            Pos  = UDim2.new(0, 0, 0, 204),
            Size = UDim2.new(0.68, -6, 0, 133),
        },
        RightTop = {
            Pos  = UDim2.new(0.7, 6, 0, 0),
            Size = UDim2.new(0.3, -6, 0, 190),
        },
        RightBottom = {
            Pos  = UDim2.new(0.7, 6, 0, 204),
            Size = UDim2.new(0.3, -6, 0, 133),
        },
    }

    local info  = layout[slot or ""]
    local props = {BorderSizePixel = 0, Parent = page, ClipsDescendants = true}

    if info then
        props.Position = info.Pos
        props.Size     = info.Size
    else
        local idx = #self._sections
        props.Position = UDim2.fromOffset(0, idx * 196)
        props.Size     = UDim2.new(1, 0, 0, 180)
    end

    local frame = New("Frame", props)
    win:_track(frame, "BackgroundColor3", "BG1")
    New("UICorner", {CornerRadius = UDim.new(0, 8), Parent = frame})
    local stroke = New("UIStroke", {Thickness = 1, Transparency = 0.25, Parent = frame})
    win:_track(stroke, "Color", "Stroke")

    local head = New("TextLabel", {
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(12, 10),
        Size = UDim2.new(1, -24, 0, 18),
        Font = Enum.Font.GothamBold,
        Text = title,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = frame,
    })
    win:_track(head, "TextColor3", "Accent")

    local inner = New("Frame", {
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(0, 34),
        Size = UDim2.new(1, 0, 1, -34),
        Parent = frame,
    })

    local list = New("UIListLayout", {
        Padding = UDim.new(0, 10),
        SortOrder = Enum.SortOrder.LayoutOrder,
        Parent = inner,
    })
    New("UIPadding", {
        PaddingTop = UDim.new(0, 6),
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 10),
        Parent = inner,
    })

    table.insert(self._sections, frame)

    local sec = setmetatable({
        Window = win,
        Frame  = frame,
        Inner  = inner,
        List   = list,
    }, Section)

    return sec
end

---------------------------------------------------------------------
-- section controls
---------------------------------------------------------------------

function Section:CreateSlider(cfg)
    local win   = self.Window
    local inner = self.Inner
    local c     = cfg or {}

    local minv  = c.Min or 0
    local maxv  = c.Max or 100
    local step  = c.Step or 1
    local value = RoundStep(math.clamp(c.Default or minv, minv, maxv), minv, step)

    local row = New("Frame", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 54),
        Parent = inner,
    })

    local label = New("TextLabel", {
        BackgroundTransparency = 1,
        Size = UDim2.new(0.6, 0, 0, 18),
        Font = Enum.Font.Gotham,
        Text = c.Name or "Slider",
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = row,
    })
    win:_track(label, "TextColor3", "DimText")

    local valueText = New("TextLabel", {
        BackgroundTransparency = 1,
        Position = UDim2.new(0.6, 0, 0, 0),
        Size = UDim2.new(0.4, 0, 0, 18),
        Font = Enum.Font.GothamBold,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Right,
        Parent = row,
    })
    win:_track(valueText, "TextColor3", "Accent")

    local track = New("Frame", {
        BorderSizePixel = 0,
        Position = UDim2.fromOffset(0, 26),
        Size = UDim2.new(1, 0, 0, 4),
        Parent = row,
    })
    win:_track(track, "BackgroundColor3", "Track")
    New("UICorner", {CornerRadius = UDim.new(0, 2), Parent = track})

    local fill = New("Frame", {
        BorderSizePixel = 0,
        Size = UDim2.new(0, 0, 1, 0),
        Parent = track,
    })
    win:_track(fill, "BackgroundColor3", "Accent")
    New("UICorner", {CornerRadius = UDim.new(0, 2), Parent = fill})

    local knob = New("Frame", {
        BorderSizePixel = 0,
        Size = UDim2.fromOffset(10, 10),
        Parent = track,
    })
    win:_track(knob, "BackgroundColor3", "Muted")
    New("UICorner", {CornerRadius = UDim.new(0, 2), Parent = knob})

    local function setVisual(v, tweenIt)
        local t = (v - minv) / (maxv - minv)
        t = Clamp01(t)

        local fillSize = UDim2.new(t, 0, 1, 0)
        local knobPos  = UDim2.new(t, -5, 0.5, -5)

        if tweenIt then
            PlayTween(fill, {Size = fillSize}, 0.12)
            PlayTween(knob, {Position = knobPos}, 0.12)
        else
            fill.Size     = fillSize
            knob.Position = knobPos
        end

        local text = c.Format and c.Format(v) or tostring(v)
        valueText.Text = text
    end

    local function setValue(v, fromUser)
        v = RoundStep(math.clamp(v, minv, maxv), minv, step)
        value = v
        setVisual(v, true)
        if fromUser and c.Callback then
            task.spawn(c.Callback, v)
        end
    end

    setVisual(value, false)

    local dragging
    local activeInput

    local function valueFromInput(input)
        local x = input.Position.X - track.AbsolutePosition.X
        local ratio = Clamp01(x / math.max(track.AbsoluteSize.X, 1))
        return minv + ratio * (maxv - minv)
    end

    local function begin(input)
        dragging    = true
        activeInput = input
        PlayTween(knob, {BackgroundColor3 = win.Theme.Accent}, 0.1)
        setValue(valueFromInput(input), true)

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging    = false
                activeInput = nil
                PlayTween(knob, {BackgroundColor3 = win.Theme.Muted}, 0.1)
            end
        end)
    end

    track.InputBegan:Connect(function(input)
        if IsMouse(input.UserInputType) or IsTouch(input.UserInputType) then
            begin(input)
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == activeInput then
            setValue(valueFromInput(input), true)
        end
    end)

    local obj = {}
    function obj:Set(v) setValue(v, false) end
    function obj:Get() return value end
    return obj
end

-- nicer toggle
-- cfg.Small = true ==> kleines Quadrat (für rechte AIMBOT-Liste)
function Section:CreateToggle(cfg)
    local win   = self.Window
    local inner = self.Inner
    local c     = cfg or {}

    local state = c.Default and true or false
    local small = c.Small or false

    local row = New("TextButton", {
        AutoButtonColor = false,
        BackgroundTransparency = 1,
        Text = "",
        Size = UDim2.new(1, 0, 0, 24),
        Parent = inner,
    })

    local label = New("TextLabel", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -70, 1, 0),
        Font = Enum.Font.Gotham,
        Text = c.Name or "Toggle",
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = row,
    })
    win:_track(label, "TextColor3", "Text")

    if small then
        local box = New("Frame", {
            BorderSizePixel = 0,
            Size = UDim2.fromOffset(16, 16),
            Position = UDim2.new(1, -24, 0.5, -8),
            Parent = row,
        })
        win:_track(box, "BackgroundColor3", "Field")
        New("UICorner", {CornerRadius = UDim.new(0, 3), Parent = box})
        local st = New("UIStroke", {Thickness = 1, Transparency = 0.55, Parent = box})
        win:_track(st, "Color", "Stroke")

        local fill = New("Frame", {
            BorderSizePixel = 0,
            Size = UDim2.new(1, -4, 1, -4),
            Position = UDim2.fromOffset(2, 2),
            Parent = box,
        })
        New("UICorner", {CornerRadius = UDim.new(0, 2), Parent = fill})

        local function render(animated)
            local col = state and win.Theme.Accent or win.Theme.Track
            if animated then
                PlayTween(fill, {BackgroundColor3 = col}, 0.12)
            else
                fill.BackgroundColor3 = col
            end
        end

        render(false)

        row.MouseButton1Click:Connect(function()
            state = not state
            render(true)
            if c.Callback then
                task.spawn(c.Callback, state)
            end
        end)
    else
        local sw = New("Frame", {
            BorderSizePixel = 0,
            Size = UDim2.fromOffset(28, 18),
            Position = UDim2.new(1, -36, 0.5, -9),
            Parent = row,
        })
        win:_track(sw, "BackgroundColor3", "Field")
        New("UICorner", {CornerRadius = UDim.new(0, 10), Parent = sw})
        local st = New("UIStroke", {Thickness = 1, Transparency = 0.55, Parent = sw})
        win:_track(st, "Color", "Stroke")

        local fill = New("Frame", {
            BorderSizePixel = 0,
            Size = UDim2.new(1, -4, 1, -4),
            Position = UDim2.fromOffset(2, 2),
            Parent = sw,
        })
        New("UICorner", {CornerRadius = UDim.new(0, 10), Parent = fill})

        local knob = New("Frame", {
            BorderSizePixel = 0,
            Size = UDim2.fromOffset(12, 12),
            Parent = sw,
        })
        New("UICorner", {CornerRadius = UDim.new(1, 0), Parent = knob})

        local function render(animated)
            local onCol  = win.Theme.Accent
            local offCol = win.Theme.Track
            local posOn  = UDim2.fromOffset(13, 3)
            local posOff = UDim2.fromOffset(3, 3)
            local col    = state and onCol or offCol

            if animated then
                PlayTween(fill, {BackgroundColor3 = col}, 0.12)
                PlayTween(knob, {Position = state and posOn or posOff, BackgroundColor3 = Color3.new(1,1,1)}, 0.12)
            else
                fill.BackgroundColor3 = col
                knob.Position         = state and posOn or posOff
                knob.BackgroundColor3 = Color3.new(1,1,1)
            end
        end

        render(false)

        row.MouseButton1Click:Connect(function()
            state = not state
            render(true)
            if c.Callback then
                task.spawn(c.Callback, state)
            end
        end)
    end

    local obj = {}
    function obj:Set(v) state = v and true or false end
    function obj:Get() return state end
    return obj
end

function Section:CreateButton(cfg)
    local win   = self.Window
    local inner = self.Inner
    local c     = cfg or {}

    local btn = New("TextButton", {
        AutoButtonColor = false,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 24),
        Font = Enum.Font.GothamBold,
        Text = c.Name or "Button",
        TextSize = 12,
        Parent = inner,
    })
    win:_track(btn, "BackgroundColor3", "Field")
    win:_track(btn, "TextColor3", "Text")
    New("UICorner", {CornerRadius = UDim.new(0, 3), Parent = btn})
    local st = New("UIStroke", {Thickness = 1, Transparency = 0.55, Parent = btn})
    win:_track(st, "Color", "Stroke")

    btn.MouseButton1Click:Connect(function()
        PlayTween(btn, {BackgroundColor3 = win.Theme.Track}, 0.08)
        if c.Callback then
            task.spawn(c.Callback)
        end
        task.delay(0.08, function()
            PlayTween(btn, {BackgroundColor3 = win.Theme.Field}, 0.12)
        end)
    end)

    return btn
end

function Section:CreateTextbox(cfg)
    local win   = self.Window
    local inner = self.Inner
    local c     = cfg or {}

    local box = New("TextBox", {
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 24),
        Font = Enum.Font.Gotham,
        Text = c.Default or "",
        PlaceholderText = c.Placeholder or "Enter text here",
        TextSize = 12,
        ClearTextOnFocus = false,
        Parent = inner,
    })
    win:_track(box, "BackgroundColor3", "Field")
    win:_track(box, "TextColor3", "Text")
    box.PlaceholderColor3 = win.Theme.Muted
    New("UICorner", {CornerRadius = UDim.new(0, 3), Parent = box})
    local st = New("UIStroke", {Thickness = 1, Transparency = 0.55, Parent = box})
    win:_track(st, "Color", "Stroke")

    box.FocusLost:Connect(function(enterPressed)
        if c.Callback then
            task.spawn(c.Callback, box.Text, enterPressed)
        end
    end)

    local obj = {}
    function obj:SetText(t) box.Text = t end
    function obj:GetText() return box.Text end
    return obj
end

function Section:CreateDropdown(cfg)
    local win   = self.Window
    local inner = self.Inner
    local c     = cfg or {}

    local options = c.Options or {}
    local current = c.Default or options[1] or "None"
    local open    = false

    local wrap = New("Frame", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 30),
        AutomaticSize = Enum.AutomaticSize.Y,
        Parent = inner,
    })

    local head = New("TextButton", {
        AutoButtonColor = false,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 24),
        Text = "",
        Parent = wrap,
    })
    win:_track(head, "BackgroundColor3", "Field")
    New("UICorner", {CornerRadius = UDim.new(0, 3), Parent = head})
    local st = New("UIStroke", {Thickness = 1, Transparency = 0.55, Parent = head})
    win:_track(st, "Color", "Stroke")

    local nameLbl = New("TextLabel", {
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(10, 0),
        Size = UDim2.new(0.6, -10, 1, 0),
        Font = Enum.Font.Gotham,
        Text = c.Name or "Dropdown",
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = head,
    })
    win:_track(nameLbl, "TextColor3", "DimText")

    local valLbl = New("TextLabel", {
        BackgroundTransparency = 1,
        Position = UDim2.new(0.6, 0, 0, 0),
        Size = UDim2.new(0.4, -26, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = tostring(current),
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Right,
        Parent = head,
    })
    win:_track(valLbl, "TextColor3", "Text")

    local arrow = New("TextLabel", {
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -22, 0, 0),
        Size = UDim2.fromOffset(20, 24),
        Font = Enum.Font.GothamBold,
        Text = "▾",
        TextSize = 14,
        Parent = head,
    })
    win:_track(arrow, "TextColor3", "Muted")

    local listWrap = New("Frame", {
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(0, 28),
        Size = UDim2.new(1, 0, 0, 0),
        ClipsDescendants = true,
        Parent = wrap,
    })

    local listBg = New("Frame", {
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 0),
        Parent = listWrap,
    })
    win:_track(listBg, "BackgroundColor3", "Field")
    New("UICorner", {CornerRadius = UDim.new(0, 3), Parent = listBg})
    local st2 = New("UIStroke", {Thickness = 1, Transparency = 0.55, Parent = listBg})
    win:_track(st2, "Color", "Stroke")

    local list = New("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6),
        Parent = listBg,
    })
    New("UIPadding", {
        PaddingTop = UDim.new(0, 8),
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 8),
        Parent = listBg,
    })

    local function rebuild()
        for _, child in ipairs(listBg:GetChildren()) do
            if child:IsA("TextButton") then
                child:Destroy()
            end
        end

        for _, opt in ipairs(options) do
            local b = New("TextButton", {
                AutoButtonColor = false,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 0, 20),
                Font = Enum.Font.Gotham,
                Text = tostring(opt),
                TextSize = 12,
                TextXAlignment = Enum.TextXAlignment.Left,
                Parent = listBg,
            })
            b.TextColor3 = (opt == current) and win.Theme.Accent or win.Theme.Text

            b.MouseButton1Click:Connect(function()
                current = opt
                valLbl.Text = tostring(current)
                if c.Callback then
                    task.spawn(c.Callback, current)
                end
                rebuild()
                open = false
                PlayTween(listWrap, {Size = UDim2.new(1, 0, 0, 0)}, 0.14)
                PlayTween(listBg,   {Size = UDim2.new(1, 0, 0, 0)}, 0.14)
                arrow.Text = "▾"
            end)
        end
    end

    rebuild()

    local function setOpen(state)
        open = state
        if open then
            task.wait()
            local h = list.AbsoluteContentSize.Y + 16
            PlayTween(listWrap, {Size = UDim2.new(1, 0, 0, h)}, 0.14)
            PlayTween(listBg,   {Size = UDim2.new(1, 0, 0, h)}, 0.14)
            arrow.Text = "▴"
        else
            PlayTween(listWrap, {Size = UDim2.new(1, 0, 0, 0)}, 0.14)
            PlayTween(listBg,   {Size = UDim2.new(1, 0, 0, 0)}, 0.14)
            arrow.Text = "▾"
        end
    end

    head.MouseButton1Click:Connect(function()
        setOpen(not open)
    end)

    local obj = {}
    function obj:SetOptions(opts)
        options = opts or {}
        if not table.find(options, current) then
            current = options[1] or "None"
            valLbl.Text = tostring(current)
        end
        rebuild()
        setOpen(false)
    end
    function obj:Set(v)
        if table.find(options, v) then
            current = v
            valLbl.Text = tostring(current)
            rebuild()
        end
    end
    function obj:Get() return current end
    return obj
end

---------------------------------------------------------------------
-- Vanith:CreateWindow
---------------------------------------------------------------------

function Vanith:CreateWindow(opts)
    opts = opts or {}

    local theme = {}
    for k, v in pairs(DEFAULT_THEME) do
        theme[k] = v
    end
    for k, v in pairs(opts.Theme or {}) do
        theme[k] = v
    end

    local parent
    do
        local ok, cg = pcall(function()
            if gethui then
                return gethui()
            end
            return game:GetService("CoreGui")
        end)
        if ok and cg then
            parent = cg
        else
            local lp = Players.LocalPlayer
            parent = lp and lp:FindFirstChildOfClass("PlayerGui") or nil
        end
    end

    local self = setmetatable({
        Theme          = theme,
        _themeBindings = {},
        Tabs           = {},
        TopTabs        = {},
    }, Window)

    local gui = New("ScreenGui", {
        Name = opts.Name or "VanithUI",
        ResetOnSpawn = false,
        IgnoreGuiInset = true,
        Parent = parent,
    })
    self.Gui = gui

    local main = New("Frame", {
        Size = opts.Size or UDim2.fromOffset(649, 417),
        Position = opts.Position or UDim2.fromScale(0.5, 0.5),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BorderSizePixel = 0,
        Parent = gui,
    })
    self.Main = main
    self:_track(main, "BackgroundColor3", "BG0")
    New("UICorner", {CornerRadius = UDim.new(0, 10), Parent = main})
    local ms = New("UIStroke", {Thickness = 1, Transparency = 0.2, Parent = main})
    self:_track(ms, "Color", "Stroke")

    local glass = New("Frame", {
        BackgroundColor3 = Color3.new(1, 1, 1),
        BackgroundTransparency = 0.97,
        BorderSizePixel = 0,
        Size = UDim2.fromScale(1, 1),
        Parent = main,
    })
    New("UICorner", {CornerRadius = UDim.new(0, 10), Parent = glass})

    -- top bar
    local top = New("Frame", {
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 54),
        Parent = main,
        ZIndex = 2,
    })
    self.TopBar = top
    self:_track(top, "BackgroundColor3", "BG2")
    New("UICorner", {CornerRadius = UDim.new(0, 10), Parent = top})

    New("Frame", {
        BackgroundColor3 = theme.BG2,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 44),
        Size = UDim2.new(1, 0, 0, 20),
        Parent = top,
        ZIndex = 1,
    })

    -- brand box (Vanith)
    local brand = New("Frame", {
        BorderSizePixel = 0,
        Position = UDim2.fromOffset(12, 10),
        Size = UDim2.fromOffset(140, 34),
        Parent = top,
        ZIndex = 3,
    })
    self:_track(brand, "BackgroundColor3", "BG1")
    New("UICorner", {CornerRadius = UDim.new(0, 8), Parent = brand})
    local bStroke = New("UIStroke", {Thickness = 1, Transparency = 0.55, Parent = brand})
    self:_track(bStroke, "Color", "Stroke")

    local brandLabel = New("TextLabel", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -16, 1, 0),
        Position = UDim2.fromOffset(8, 0),
        Font = Enum.Font.GothamBold,
        Text = opts.Title or "Vanith",
        TextSize = 15,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = brand,
    })
    self:_track(brandLabel, "TextColor3", "Accent")

    -- top tab strip
    local strip = New("Frame", {
        BorderSizePixel = 0,
        Position = UDim2.fromOffset(160, 10),
        Size = UDim2.new(1, -220, 0, 34),
        Parent = top,
        ZIndex = 2,
    })
    self:_track(strip, "BackgroundColor3", "BG1")
    New("UICorner", {CornerRadius = UDim.new(0, 8), Parent = strip})
    local sStroke = New("UIStroke", {Thickness = 1, Transparency = 0.5, Parent = strip})
    self:_track(sStroke, "Color", "Stroke")

    local tabsHolder = New("Frame", {
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(8, 0),
        Size = UDim2.new(1, -16, 1, 0),
        Parent = strip,
        ZIndex = 2,
    })
    self.TopTabsHolder = tabsHolder

    local topLayout = New("UIListLayout", {
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 16),
        Parent = tabsHolder,
    })
    topLayout.VerticalAlignment = Enum.VerticalAlignment.Center

    -- gear box
    local gearBox = New("Frame", {
        BorderSizePixel = 0,
        Position = UDim2.new(1, -46, 0, 10),
        Size = UDim2.fromOffset(34, 34),
        Parent = top,
        ZIndex = 3,
    })
    self:_track(gearBox, "BackgroundColor3", "BG1")
    New("UICorner", {CornerRadius = UDim.new(0, 8), Parent = gearBox})
    local gStroke = New("UIStroke", {Thickness = 1, Transparency = 0.55, Parent = gearBox})
    self:_track(gStroke, "Color", "Stroke")

    local gear = New("TextLabel", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = "⚙",
        TextSize = 18,
        Parent = gearBox,
        ZIndex = 4,
    })
    self:_track(gear, "TextColor3", "Accent")

    -- sidebar
    local sidebar = New("Frame", {
        BorderSizePixel = 0,
        Position = UDim2.fromOffset(12, 68),
        Size = UDim2.new(0, 120, 1, -80),
        Parent = main,
        ZIndex = 1,
    })
    self.Sidebar = sidebar
    self:_track(sidebar, "BackgroundColor3", "BG2")
    New("UICorner", {CornerRadius = UDim.new(0, 8), Parent = sidebar})
    local sbStroke = New("UIStroke", {Thickness = 1, Transparency = 0.25, Parent = sidebar})
    self:_track(sbStroke, "Color", "Stroke")

    local sideList = New("Frame", {
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(10, 14),
        Size = UDim2.new(1, -20, 1, -24),
        Parent = sidebar,
    })
    self.SideList = sideList
    local sideLayout = New("UIListLayout", {
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6),
        Parent = sideList,
    })
    sideLayout.VerticalAlignment = Enum.VerticalAlignment.Top

    -- pages
    local pages = New("Frame", {
        BackgroundTransparency = 1,
        Position = UDim2.fromOffset(146, 68),
        Size = UDim2.new(1, -158, 1, -80),
        Parent = main,
    })
    self.Pages = pages

    -- resize arrow bottom right
    local resize = New("Frame", {
        BackgroundTransparency = 1,
        Size = UDim2.fromOffset(16, 16),
        Position = UDim2.new(1, -18, 1, -18),
        Parent = main,
        ZIndex = 5,
    })
    local resizeLbl = New("TextLabel", {
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = "↘",
        TextSize = 14,
        Parent = resize,
    })
    self:_track(resizeLbl, "TextColor3", "Accent")

    self:_enableResize(resize, main)

    if opts.Draggable ~= false then
        self:_enableDrag(top, main)
    end

    -- simple mobile autoscale
    local scale = New("UIScale", {Parent = main})
    local cam = workspace.CurrentCamera
    if cam then
        local vp = cam.ViewportSize
        if vp.X < 900 then
            scale.Scale = math.clamp(vp.X / 900, 0.75, 1)
        end
    end

    return self
end

-- alias (klein geschrieben, falls du das lieber magst)
Vanith.Createwindow = Vanith.CreateWindow

return Vanith
