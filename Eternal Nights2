local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local ContentProvider = game:GetService("ContentProvider")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Mobile Detection
local IS_MOBILE = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled
local IS_TABLET = UserInputService.TouchEnabled and workspace.CurrentCamera.ViewportSize.X > 800

local puppetWarned = false
local lastPuppetBeep = 0
local BEEP_COOLDOWN = 12

local SOUND_ID = "rbxassetid://5914883816" 

local function PlayWarnSound(volume, pitch)
	volume = volume or 0.5
	pitch  = pitch  or 1.1

	local parent = workspace.CurrentCamera or LocalPlayer:FindFirstChildOfClass("PlayerGui") or workspace

	local s = Instance.new("Sound")
	s.SoundId = SOUND_ID
	s.Volume = volume
	s.PlaybackSpeed = pitch
	s.RollOffMode = Enum.RollOffMode.Linear
	s.RollOffMaxDistance = 60
	s.EmitterSize = 2
	s.Looped = false
	s.Name = "WarnSound"
	s.Parent = parent

	task.spawn(function()
		pcall(function() ContentProvider:PreloadAsync({s}) end)
		s:Play()
		s.Ended:Once(function()
			s:Destroy()
		end)
	end)
end

local function safeFind(path)
	local s, r = pcall(function()
		local obj = workspace
		for _, n in ipairs(path) do
			if obj:FindFirstChild(n) then
				obj = obj[n]
			else
				return nil
			end
		end
		return obj
	end)
	return s and r
end

local function tryPrompt(prompt)
	if not prompt then return end
	pcall(function()
		if typeof(prompt.InputHoldBegin) == "function" then
			prompt:InputHoldBegin()
			task.wait(prompt.HoldDuration or 0)
			if typeof(prompt.InputHoldEnd) == "function" then
				prompt:InputHoldEnd()
			end
		end
	end)
end

local hue, sat, val = 0.55, 1, 1

-- Mobile-responsive UI sizing
local BASE_W, BASE_H
local WIDTH, HEIGHT
local TOP_H
local START_POS
local SIDEBAR_WIDTH

if IS_MOBILE then
	if IS_TABLET then
		BASE_W, BASE_H = 500, 350
		SIDEBAR_WIDTH = 80
		TOP_H = 32
	else
		BASE_W, BASE_H = 320, 280
		SIDEBAR_WIDTH = 60
		TOP_H = 28
	end
	START_POS = UDim2.new(0.5, -BASE_W/2, 0.5, -BASE_H/2)
else
	BASE_W, BASE_H = 650, 300
	SIDEBAR_WIDTH = 100
	TOP_H = 28
	START_POS = UDim2.new(0.15, 0, 0.2, 20)
end

WIDTH, HEIGHT = BASE_W, BASE_H

local COLOR_BG        = Color3.fromRGB(18,18,18)
local COLOR_PANEL     = Color3.fromRGB(25,25,25)
local COLOR_SIDEBAR   = Color3.fromRGB(15,15,15)
local COLOR_HIGHLIGHT = Color3.fromHSV(hue,sat,val)
local COLOR_TEXT      = Color3.fromRGB(220,220,220)
local COLOR_SUCCESS   = Color3.fromRGB(34,197,94)
local COLOR_WARNING   = Color3.fromRGB(251,191,36)
local COLOR_ERROR     = Color3.fromRGB(239,68,68)

local sliderFills, highlightTexts, highlightActiveBoxes = {}, {}, {}
local tabButtons, pages, scrolls = {}, {}, {}
local activeTab = "Main"
local staminaToggle = { Text = "OFF" }
local puppetWarned = false
local alwaysWinLastPos = nil

local function round(obj, r)
	local c = Instance.new("UICorner", obj)
	c.CornerRadius = UDim.new(0, r or 4)
	return c
end

local function refreshUI()
	COLOR_HIGHLIGHT = Color3.fromHSV(hue, sat, val)
	for i = #sliderFills, 1, -1 do
		local inst = sliderFills[i]
		if inst and inst.Parent then
			pcall(function() inst.BackgroundColor3 = COLOR_HIGHLIGHT end)
		else
			table.remove(sliderFills, i)
		end
	end
	for i = #highlightTexts, 1, -1 do
		local inst = highlightTexts[i]
		if inst and inst.Parent then
			pcall(function() inst.TextColor3 = COLOR_HIGHLIGHT end)
		else
			table.remove(highlightTexts, i)
		end
	end
	for name, b in pairs(tabButtons) do
		if b and b.Parent then
			b.TextColor3 = (name == activeTab) and COLOR_HIGHLIGHT or COLOR_TEXT
		end
	end
end

local notificationFrame
local function createNotificationSystem()
	local gui = Instance.new("ScreenGui",
		(type(gethui)=="function" and gethui()) or CoreGui)
	gui.Name = "NotificationSystem"; gui.ResetOnSpawn = false
	gui.IgnoreGuiInset = true; gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

	notificationFrame = Instance.new("Frame", gui)
	
	-- Mobile-responsive notification positioning
	if IS_MOBILE then
		notificationFrame.Size = UDim2.new(0, 280, 1, 0)
		notificationFrame.Position = UDim2.new(1, -290, 0, 10)
	else
		notificationFrame.Size = UDim2.new(0, 300, 1, 0)
		notificationFrame.Position = UDim2.new(1, -320, 0, 20)
	end
	
	notificationFrame.BackgroundTransparency = 1

	local layout = Instance.new("UIListLayout", notificationFrame)
	layout.SortOrder = Enum.SortOrder.LayoutOrder
	layout.Padding = UDim.new(0, IS_MOBILE and 6 or 8)
end

local function showNotification(title, msg, typ, dur)
	local color = (typ=="success" and COLOR_SUCCESS) or (typ=="error" and COLOR_ERROR) or COLOR_WARNING
	local frame = Instance.new("Frame", notificationFrame)
	frame.Size = UDim2.new(1, 0, 0, IS_MOBILE and 70 or 80)
	frame.BackgroundColor3 = COLOR_PANEL; frame.BorderSizePixel = 0
	round(frame, IS_MOBILE and 6 or 8)

	local accent = Instance.new("Frame", frame)
	accent.Size = UDim2.new(0, IS_MOBILE and 3 or 4, 1, 0)
	accent.BackgroundColor3 = color
	round(accent, IS_MOBILE and 6 or 8)

	local t = Instance.new("TextLabel", frame)
	t.Text = title; t.Font = Enum.Font.GothamBold
	t.TextSize = IS_MOBILE and 13 or 16
	t.TextColor3 = color
	t.BackgroundTransparency = 1
	t.Position = UDim2.new(0, IS_MOBILE and 12 or 16, 0, 6)
	t.Size = UDim2.new(1, IS_MOBILE and -24 or -32, 0, 18)
	t.TextXAlignment = Enum.TextXAlignment.Left
	t.TextScaled = IS_MOBILE

	local m = Instance.new("TextLabel", frame)
	m.Text = msg; m.Font = Enum.Font.Gotham
	m.TextSize = IS_MOBILE and 11 or 14
	m.TextColor3 = COLOR_TEXT
	m.BackgroundTransparency = 1
	m.Position = UDim2.new(0, IS_MOBILE and 12 or 16, 0, 28)
	m.Size = UDim2.new(1, IS_MOBILE and -24 or -32, 0, 36)
	m.TextXAlignment = Enum.TextXAlignment.Left
	m.TextYAlignment = Enum.TextYAlignment.Top
	m.TextWrapped = true
	m.TextScaled = IS_MOBILE

	task.delay(dur or 2, function()
		local tween = TweenService:Create(frame, TweenInfo.new(0.3), {
			Position = UDim2.new(1, 50, 0, 0),
			BackgroundTransparency = 1
		})
		tween:Play()
		tween.Completed:Connect(function() frame:Destroy() end)
	end)
end

LocalPlayer.Idled:Connect(function()
	VirtualUser:CaptureController()
	VirtualUser:ClickButton2(Vector2.new(0,0))
end)
task.spawn(function()
	while task.wait(60) do
		VirtualUser:CaptureController()
		VirtualUser:ClickButton2(Vector2.new(0,0))
	end
end)

createNotificationSystem()
do
	local allowed = { [11392373641] = true, [76758897829889] = true }
	if not allowed[game.PlaceId] then
		pcall(function()
			showNotification("Vanith | Eternal nights", "Wrong Place found please join Eternal Nights", "error", 4)
		end)
		return
	end
end

local screenGui = Instance.new("ScreenGui",
	(type(gethui)=="function" and gethui()) or CoreGui)
screenGui.Name = "FrostHubStyle_EN"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local main = Instance.new("Frame", screenGui)
main.Size = UDim2.new(0, WIDTH, 0, HEIGHT)
main.Position = START_POS
main.BackgroundColor3 = COLOR_BG
round(main, IS_MOBILE and 4 or 6)
main.ClipsDescendants = false

local topBar = Instance.new("Frame", main)
topBar.Size = UDim2.new(1, 0, 0, TOP_H)
topBar.BackgroundTransparency = 1

local titleLbl = Instance.new("TextLabel", topBar)
titleLbl.Text = IS_MOBILE and "Vanith | EN" or "Vanith | Eternal Nights"
titleLbl.Font = Enum.Font.GothamBold
titleLbl.TextSize = IS_MOBILE and 12 or 16
titleLbl.TextColor3 = COLOR_HIGHLIGHT
titleLbl.BackgroundTransparency = 1
titleLbl.Position = UDim2.new(0, IS_MOBILE and -30 or -60, 0, 0)
titleLbl.Size = UDim2.new(0, IS_MOBILE and 150 or 300, 1, 0)
titleLbl.TextScaled = IS_MOBILE
table.insert(highlightTexts, titleLbl)

local btnMin = Instance.new("TextButton", topBar)
btnMin.Text = "_"; btnMin.Font = Enum.Font.GothamBold
btnMin.TextSize = IS_MOBILE and 16 or 20
btnMin.TextColor3 = COLOR_HIGHLIGHT
btnMin.BackgroundTransparency = 1
btnMin.Size = UDim2.new(0, IS_MOBILE and 24 or 28, 0, TOP_H)
btnMin.Position = UDim2.new(1, IS_MOBILE and -52 or -60, 0, 0)
table.insert(highlightTexts, btnMin)

local btnClose = Instance.new("TextButton", topBar)
btnClose.Text = "X"; btnClose.Font = Enum.Font.GothamBold
btnClose.TextSize = IS_MOBILE and 14 or 18
btnClose.TextColor3 = COLOR_HIGHLIGHT
btnClose.BackgroundTransparency = 1
btnClose.Size = UDim2.new(0, IS_MOBILE and 24 or 28, 0, TOP_H)
btnClose.Position = UDim2.new(1, IS_MOBILE and -28 or -32, 0, 0)
table.insert(highlightTexts, btnClose)

-- Touch-friendly dragging
do
	local dragging, dragInput, dragStart, startPos
	
	local function onInputBegan(i)
		if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
			dragging, dragStart, startPos = true, i.Position, main.Position
			i.Changed:Connect(function()
				if i.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end
	
	local function onInputChanged(i)
		if i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch then
			dragInput = i
		end
	end
	
	topBar.InputBegan:Connect(onInputBegan)
	topBar.InputChanged:Connect(onInputChanged)
	
	UserInputService.InputChanged:Connect(function(i)
		if dragging and i == dragInput then
			local delta = i.Position - dragStart
			main.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)
end

local minimized, miniFrame, lastMiniPos = false, nil, START_POS
btnMin.MouseButton1Click:Connect(function()
	if not minimized then
		minimized = true
		main.Visible = false

		miniFrame = Instance.new("Frame", screenGui)
		miniFrame.Name = "Mini ❄️"
		miniFrame.Size = UDim2.new(0, IS_MOBILE and 40 or 50, 0, IS_MOBILE and 40 or 50)
		miniFrame.Position = lastMiniPos
		miniFrame.BackgroundColor3 = COLOR_BG
		miniFrame.BorderSizePixel = 0
		miniFrame.Active = true
		round(miniFrame, 4)

		local icon = Instance.new("TextLabel", miniFrame)
		icon.Text = "❄️"; icon.Font = Enum.Font.GothamBold
		icon.TextSize = IS_MOBILE and 22 or 28
		icon.TextColor3 = COLOR_HIGHLIGHT
		icon.BackgroundTransparency = 1
		icon.Size = UDim2.new(1, 0, 1, 0)
		icon.TextXAlignment = Enum.TextXAlignment.Center
		icon.TextYAlignment = Enum.TextYAlignment.Center
		table.insert(highlightTexts, icon)

		local dragging, dragInput, dragStart, startPos, moved = false, nil, nil, nil, false
		
		miniFrame.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
				dragging = true; moved = false
				dragStart = input.Position
				startPos = miniFrame.Position
				input.Changed:Connect(function()
					if input.UserInputState == Enum.UserInputState.End then
						dragging = false
						lastMiniPos = miniFrame.Position
					end
				end)
			end
		end)
		
		miniFrame.InputChanged:Connect(function(input)
			if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
				local delta = input.Position - dragStart
				if not moved and (math.abs(delta.X) > 5 or math.abs(delta.Y) > 5) then moved = true end
				miniFrame.Position = UDim2.new(
					startPos.X.Scale, startPos.X.Offset + delta.X,
					startPos.Y.Scale, startPos.Y.Offset + delta.Y
				)
			end
		end)
		
		miniFrame.InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
				if not moved then
					minimized = false
					miniFrame:Destroy()
					main.Visible = true
					btnMin.Text = "_"
				end
			end
		end)

		btnMin.Text = "⬆"
		showNotification("FrostHub", "GUI minimized", "info", 2)
	else
		minimized = false
		if miniFrame then miniFrame:Destroy() end
		main.Visible = true
		btnMin.Text = "_"
	end
end)

btnClose.MouseButton1Click:Connect(function() screenGui:Destroy() end)

local sidebar = Instance.new("Frame", main)
sidebar.Size = UDim2.new(0, SIDEBAR_WIDTH, 1, -TOP_H)
sidebar.Position = UDim2.new(0, 0, 0, TOP_H)
sidebar.BackgroundColor3 = COLOR_SIDEBAR
round(sidebar, 4)

local content = Instance.new("Frame", main)
content.Size = UDim2.new(1, -SIDEBAR_WIDTH, 1, -TOP_H)
content.Position = UDim2.new(0, SIDEBAR_WIDTH, 0, TOP_H)
content.BackgroundColor3 = COLOR_PANEL
round(content, 4)

local tabNames = {"Main", "ESP", "Misc", "TP"}
local tabSpacing = IS_MOBILE and 32 or 36

for i, name in ipairs(tabNames) do
	local b = Instance.new("TextButton", sidebar)
	b.Name = name .. "Tab"
	b.Text = name
	b.Font = Enum.Font.Gotham
	b.TextSize = IS_MOBILE and 12 or 16
	b.TextColor3 = (name == activeTab) and COLOR_HIGHLIGHT or COLOR_TEXT
	b.BackgroundTransparency = 1
	b.Size = UDim2.new(1, 0, 0, IS_MOBILE and 28 or 32)
	b.Position = UDim2.new(0, 0, 0, (i - 1) * tabSpacing)
	b.TextScaled = IS_MOBILE
	tabButtons[name] = b

	local p = Instance.new("Frame", content)
	p.Name = name .. "Page"
	p.Size = UDim2.new(1, 0, 1, 0)
	p.BackgroundTransparency = 1
	p.Visible = (name == activeTab)
	pages[name] = p

	local scroll = Instance.new("ScrollingFrame", p)
	scroll.Size = UDim2.new(1, 0, 1, 0)
	scroll.Position = UDim2.new(0, 0, 0, 0)
	scroll.BackgroundTransparency = 1
	scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
	scroll.CanvasSize = UDim2.new(0, 0, 0, 0)
	scroll.ScrollBarThickness = IS_MOBILE and 4 or 6

	if name == "Main" then
		scroll.ScrollingEnabled = false
		scroll.ScrollBarThickness = 0
		scroll.ScrollBarImageTransparency = 1
	else
		scroll.ScrollingEnabled = true
		scroll.ScrollBarThickness = IS_MOBILE and 4 or 0
		scroll.ScrollBarImageTransparency = IS_MOBILE and 0.5 or 1
		scroll.VerticalScrollBarInset = Enum.ScrollBarInset.None
		scroll.ElasticBehavior = Enum.ElasticBehavior.WhenScrollable
	end

	scrolls[name] = scroll
end

local function showPage(name)
	activeTab = name
	for t, p in pairs(pages) do p.Visible = (t == name) end
	for t, b in pairs(tabButtons) do
		b.TextColor3 = (t == name) and COLOR_HIGHLIGHT or COLOR_TEXT
	end
end

for name, btn in pairs(tabButtons) do
	btn.MouseButton1Click:Connect(function() showPage(name) end)
end

-- Main Page with mobile-responsive layout
do
	local p = pages.Main
	local scroll = scrolls.Main
	local pad = IS_MOBILE and 8 or 16

	if IS_MOBILE then
		-- Stacked layout for mobile
		local avatar = Instance.new("ImageLabel", scroll)
		avatar.Size = UDim2.new(0, 48, 0, 48)
		avatar.Position = UDim2.new(0.5, -24, 0, pad)
		avatar.BackgroundTransparency = 1
		round(avatar, 24)
		task.spawn(function()
			local img = Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
			avatar.Image = img
		end)

		local nameLbl = Instance.new("TextLabel", scroll)
		nameLbl.Text = LocalPlayer.Name
		nameLbl.Font = Enum.Font.GothamBold
		nameLbl.TextSize = 14
		nameLbl.TextColor3 = COLOR_HIGHLIGHT
		nameLbl.BackgroundTransparency = 1
		nameLbl.Position = UDim2.new(0, pad, 0, pad + 56)
		nameLbl.Size = UDim2.new(1, -pad * 2, 0, 20)
		nameLbl.TextScaled = true
		table.insert(highlightTexts, nameLbl)

		local verLbl = Instance.new("TextLabel", scroll)
		verLbl.Text = "v1.0.2"
		verLbl.Font = Enum.Font.Gotham
		verLbl.TextSize = 11
		verLbl.TextColor3 = COLOR_HIGHLIGHT
		verLbl.BackgroundTransparency = 1
		verLbl.Position = UDim2.new(0, pad, 0, pad + 80)
		verLbl.Size = UDim2.new(1, -pad * 2, 0, 16)
		table.insert(highlightTexts, verLbl)

		local joinBtn = Instance.new("TextButton", scroll)
		joinBtn.Text = "Discord"
		joinBtn.Font = Enum.Font.GothamBold
		joinBtn.TextSize = 12
		joinBtn.TextColor3 = COLOR_HIGHLIGHT
		joinBtn.BackgroundColor3 = COLOR_SIDEBAR
		joinBtn.Size = UDim2.new(1, -pad * 2, 0, 28)
		joinBtn.Position = UDim2.new(0, pad, 0, pad + 104)
		round(joinBtn, 4)
		table.insert(highlightTexts, joinBtn)
		joinBtn.MouseButton1Click:Connect(function()
			if typeof(setclipboard) == "function" then
				setclipboard("https://discord.gg/Ab73VVR4JK")
				showNotification("Discord", "Link copied!", "success", 3)
			else
				showNotification("Discord", "Clipboard not supported!", "error", 3)
			end
		end)

		local statsFrame = Instance.new("Frame", scroll)
		statsFrame.Size = UDim2.new(1, -pad * 2, 0, 60)
		statsFrame.Position = UDim2.new(0, pad, 0, pad + 140)
		statsFrame.BackgroundColor3 = COLOR_SIDEBAR
		round(statsFrame, 6)

		local fpsLbl = Instance.new("TextLabel", statsFrame)
		fpsLbl.Text = "FPS: 0"
		fpsLbl.Font = Enum.Font.Gotham
		fpsLbl.TextSize = 12
		fpsLbl.TextColor3 = COLOR_HIGHLIGHT
		fpsLbl.BackgroundTransparency = 1
		fpsLbl.Position = UDim2.new(0, 8, 0, 8)
		fpsLbl.Size = UDim2.new(1, -16, 0, 16)
		table.insert(highlightTexts, fpsLbl)

		local pingLbl = Instance.new("TextLabel", statsFrame)
		pingLbl.Text = "Ping: 0ms"
		pingLbl.Font = Enum.Font.Gotham
		pingLbl.TextSize = 12
		pingLbl.TextColor3 = COLOR_HIGHLIGHT
		pingLbl.BackgroundTransparency = 1
		pingLbl.Position = UDim2.new(0, 8, 0, 28)
		pingLbl.Size = UDim2.new(1, -16, 0, 16)
		table.insert(highlightTexts, pingLbl)

		RunService.RenderStepped:Connect(function(dt)
			fpsLbl.Text = "FPS: " .. math.floor(1 / dt)
		end)
		
		task.spawn(function()
			while task.wait(1) do
				pcall(function()
					pingLbl.Text = "Ping: " .. math.floor(LocalPlayer:GetNetworkPing() * 1000) .. "ms"
				end)
			end
		end)
	else
		-- Original desktop layout
		local left = Instance.new("Frame", scroll)
		left.Size = UDim2.new(0, 300, 0, 110)
		left.Position = UDim2.new(0, pad, 0, pad)
		left.BackgroundColor3 = COLOR_SIDEBAR
		round(left, 8)

		local avatar = Instance.new("ImageLabel", left)
		avatar.Size = UDim2.new(0, 64, 0, 64)
		avatar.Position = UDim2.new(0, 16, 0, 16)
		avatar.BackgroundTransparency = 1
		round(avatar, 32)
		task.spawn(function()
			local img = Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
			avatar.Image = img
		end)

		local offsetX = 88
		local nameLbl = Instance.new("TextLabel", left)
		nameLbl.Text = LocalPlayer.Name
		nameLbl.Font = Enum.Font.GothamBold
		nameLbl.TextSize = 20
		nameLbl.TextColor3 = COLOR_HIGHLIGHT
		nameLbl.BackgroundTransparency = 1
		nameLbl.Position = UDim2.new(0, offsetX, 0, 16)
		nameLbl.Size = UDim2.new(0, 180, 0, 24)
		table.insert(highlightTexts, nameLbl)

		local verLbl = Instance.new("TextLabel", left)
		verLbl.Text = "Version: v1.0.2"
		verLbl.Font = Enum.Font.Gotham
		verLbl.TextSize = 14
		verLbl.TextColor3 = COLOR_HIGHLIGHT
		verLbl.BackgroundTransparency = 1
		verLbl.Position = UDim2.new(0, offsetX, 0, 44)
		verLbl.Size = UDim2.new(0, 180, 0, 18)
		table.insert(highlightTexts, verLbl)

		local joinBtn = Instance.new("TextButton", left)
		joinBtn.Text = "Join Discord"
		joinBtn.Font = Enum.Font.GothamBold
		joinBtn.TextSize = 16
		joinBtn.TextColor3 = COLOR_HIGHLIGHT
		joinBtn.BackgroundColor3 = COLOR_SIDEBAR
		joinBtn.Size = UDim2.new(1, -88, 0, 30)
		joinBtn.Position = UDim2.new(0, 74, 0, 74)
		round(joinBtn, 6)
		table.insert(highlightTexts, joinBtn)
		joinBtn.MouseButton1Click:Connect(function()
			if typeof(setclipboard) == "function" then
				setclipboard("https://discord.gg/Ab73VVR4JK")
				showNotification("Discord", "Discord link copied to clipboard!", "success", 3)
			else
				showNotification("Discord", "Clipboard function not supported!", "error", 3)
			end
		end)

		local right = Instance.new("Frame", scroll)
		right.Size = UDim2.new(0, 200, 0, 110)
		right.Position = UDim2.new(1, -(200 + pad), 0, pad)
		right.BackgroundColor3 = COLOR_SIDEBAR
		round(right, 8)

		local fpsLbl = Instance.new("TextLabel", right)
		fpsLbl.Text = "FPS: 0"
		fpsLbl.Font = Enum.Font.Gotham
		fpsLbl.TextSize = 16
		fpsLbl.TextColor3 = COLOR_HIGHLIGHT
		fpsLbl.BackgroundTransparency = 1
		fpsLbl.Position = UDim2.new(0, 8, 0, 20)
		fpsLbl.Size = UDim2.new(1, -16, 0, 20)
		table.insert(highlightTexts, fpsLbl)

		local pingLbl = Instance.new("TextLabel", right)
		pingLbl.Text = "Ping: 0 ms"
		pingLbl.Font = Enum.Font.Gotham
		pingLbl.TextSize = 16
		pingLbl.TextColor3 = COLOR_HIGHLIGHT
		pingLbl.BackgroundTransparency = 1
		pingLbl.Position = UDim2.new(0, 8, 0, 48)
		pingLbl.Size = UDim2.new(1, -16, 0, 20)
		table.insert(highlightTexts, pingLbl)

		local unlockBtn = Instance.new("TextButton", right)
		unlockBtn.Text = "Unlock FPS"
		unlockBtn.Font = Enum.Font.GothamBold
		unlockBtn.TextSize = 16
		unlockBtn.TextColor3 = COLOR_HIGHLIGHT
		unlockBtn.BackgroundColor3 = COLOR_SIDEBAR
		unlockBtn.Size = UDim2.new(1, -16, 0, 30)
		unlockBtn.Position = UDim2.new(0, 8, 0, 74)
		round(unlockBtn, 6)
		table.insert(highlightTexts, unlockBtn)
		unlockBtn.MouseButton1Click:Connect(function()
			if typeof(setfpscap) == "function" then
				setfpscap(9999)
				showNotification("Performance", "FPS unlocked", "success", 2)
			else
				showNotification("Performance", "setfpscap not supported", "error", 2)
			end
		end)

		RunService.RenderStepped:Connect(function(dt)
			fpsLbl.Text = "FPS: " .. math.floor(1 / dt)
		end)
		
		task.spawn(function()
			while task.wait(1) do
				pcall(function()
					pingLbl.Text = "Ping: " .. math.floor(LocalPlayer:GetNetworkPing() * 1000) .. " ms"
				end)
			end
		end)

		local logLbl = Instance.new("TextLabel", scroll)
		logLbl.Text = table.concat({
			"Changelog:",
			"- Mobile-optimized UI",
			"- Touch-friendly controls",
			"- ESP glow for Fuse, Chest, Tools",
			"- Safe TP checks for animatronics",
			"- Stamina Infinity toggler",
			"- Puppet low-timer notifications",
		}, "\n")
		logLbl.Font = Enum.Font.Gotham
		logLbl.TextSize = 14
		logLbl.TextColor3 = COLOR_HIGHLIGHT
		logLbl.TextXAlignment = Enum.TextXAlignment.Left
		logLbl.TextYAlignment = Enum.TextYAlignment.Top
		logLbl.BackgroundColor3 = COLOR_SIDEBAR
		logLbl.Position = UDim2.new(0, pad, 0, 110 + pad * 2)
		logLbl.Size = UDim2.new(1, -pad * 2, 0, 120)
		round(logLbl, 8)
		table.insert(highlightTexts, logLbl)
	end
end

local function createBillboard(color)
	local gui = Instance.new("BillboardGui")
	gui.Size = UDim2.new(0, IS_MOBILE and 150 or 200, 0, IS_MOBILE and 36 or 48)
	gui.AlwaysOnTop = true
	gui.StudsOffset = Vector3.new(0, 3, 0)

	local lbl = Instance.new("TextLabel")
	lbl.BackgroundTransparency = 1
	lbl.Size = UDim2.new(1, 0, 1, 0)
	lbl.Font = Enum.Font.GothamBold
	lbl.TextSize = IS_MOBILE and 12 or 16
	lbl.TextColor3 = color
	lbl.TextStrokeTransparency = 0.5
	lbl.TextScaled = IS_MOBILE
	lbl.Parent = gui

	local glow = Instance.new("Highlight")
	glow.Name = "ESP_Glow"
	glow.FillTransparency = 1
	glow.OutlineTransparency = 0
	glow.OutlineColor = color
	glow.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop

	return gui, lbl, glow
end

local function isAnimatronicNearPosition(pos)
	local anims = safeFind({"Game", "Animatronics", "Animatronics"})
	if not anims then return false end
	for _, m in pairs(anims:GetChildren()) do
		if m:IsA("Model") and m:FindFirstChild("HumanoidRootPart") then
			if m.Name ~= "Cupcake" and m.Name ~= "Puppet" then
				local dist = (m.HumanoidRootPart.Position - pos).Magnitude
				if dist <= 25 then return true end
			end
		end
	end
	return false
end

local activeESP, fuseESP, chestESP = {}, {}, {}
local plierESP, cameraESP, screwESP = {}, {}, {}

local function updateFuses()
	for _, v in pairs(workspace:GetChildren()) do
		if v:IsA("Tool") and v.Name == "Fuse" and v:FindFirstChild("Handle") then
			local prompt = v.Handle:FindFirstChildOfClass("ProximityPrompt")
			if prompt and not fuseESP[v] then
				local gui, lbl, glow = createBillboard(Color3.fromRGB(0, 255, 255))
				gui.Adornee = v.Handle
				gui.Parent = screenGui
				glow.Parent = v.Handle
				glow.Enabled = false
				fuseESP[v] = { gui = gui, label = lbl, part = v.Handle, glow = glow, prompt = prompt }
			end
		end
	end
end

local function updateChests()
	local chestsFolder = workspace:FindFirstChild("Map")
		and workspace.Map:FindFirstChild("Baus")
		and workspace.Map.Baus:FindFirstChild("Bau")
	if not chestsFolder then return end
	for _, v in pairs(chestsFolder:GetChildren()) do
		if v:IsA("Model") then
			local part = v:FindFirstChild("PrimaryPart") or v:FindFirstChildWhichIsA("BasePart")
			if part and not chestESP[v] then
				local gui, lbl, glow = createBillboard(Color3.fromRGB(0, 255, 100))
				gui.Adornee = part
				gui.Parent = screenGui
				glow.Parent = v
				glow.Enabled = false
				chestESP[v] = { gui = gui, label = lbl, part = part, glow = glow }
			end
		end
	end
end

local function updatePliers()
	for _, v in pairs(workspace:GetChildren()) do
		if v:IsA("Tool") and v.Name == "Pliers" and v:FindFirstChild("Handle") and not plierESP[v] then
			local gui, lbl, glow = createBillboard(Color3.fromRGB(255, 150, 255))
			gui.Adornee = v.Handle
			gui.Parent = screenGui
			glow.Parent = v.Handle
			glow.Enabled = false
			plierESP[v] = { gui = gui, label = lbl, part = v.Handle, glow = glow }
		end
	end
end

local function updateCamera()
	for _, v in pairs(workspace:GetChildren()) do
		if v:IsA("Tool") and v.Name == "Photo Camera" and v:FindFirstChild("Handle") and not cameraESP[v] then
			local gui, lbl, glow = createBillboard(Color3.fromRGB(255, 255, 150))
			gui.Adornee = v.Handle
			gui.Parent = screenGui
			glow.Parent = v.Handle
			glow.Enabled = false
			cameraESP[v] = { gui = gui, label = lbl, part = v.Handle, glow = glow }
		end
	end
end

local function updateScrew()
	for _, v in pairs(workspace:GetChildren()) do
		if v:IsA("Tool") and v.Name == "Phillips screwdriver" and v:FindFirstChild("Handle") and not screwESP[v] then
			local gui, lbl, glow = createBillboard(Color3.fromRGB(255, 100, 100))
			gui.Adornee = v.Handle
			gui.Parent = screenGui
			glow.Parent = v.Handle
			glow.Enabled = false
			screwESP[v] = { gui = gui, label = lbl, part = v.Handle, glow = glow }
		end
	end
end

local animColors = {
	Bonnie = Color3.fromRGB(0, 150, 255),
	Chica = Color3.fromRGB(255, 255, 0),
	Freddy = Color3.fromRGB(139, 69, 19),
	Foxy = Color3.fromRGB(255, 0, 0),
	GoldenFreddy = Color3.fromRGB(255, 215, 0),
}

local function updateAnimatronics()
	local anims = safeFind({"Game", "Animatronics", "Animatronics"})
	if anims then
		for _, m in pairs(anims:GetChildren()) do
			if m:IsA("Model") and m:FindFirstChild("HumanoidRootPart") and not activeESP[m] then
				local color = animColors[m.Name] or Color3.fromRGB(255, 170, 0)
				local gui, lbl, glow = createBillboard(color)
				gui.Adornee = m.HumanoidRootPart
				gui.Parent = screenGui
				glow.Parent = m
				glow.Enabled = false
				activeESP[m] = { gui = gui, label = lbl, part = m.HumanoidRootPart, glow = glow }
			end
		end
	end
end

task.spawn(function()
	while task.wait(2) do
		updateFuses(); updateChests(); updatePliers(); updateCamera(); updateScrew(); updateAnimatronics()
	end
end)

-- ESP Page with mobile-responsive controls
do
	local p = scrolls.ESP
	local y = IS_MOBILE and 8 or 16

	local function makeCheckbox(text, default, yPos, cb)
		local h = IS_MOBILE and 28 or 30
		local frame = Instance.new("Frame", p)
		frame.Size = UDim2.new(1, IS_MOBILE and -16 or -32, 0, h)
		frame.Position = UDim2.new(0, IS_MOBILE and 8 or 16, 0, yPos)
		frame.BackgroundColor3 = COLOR_SIDEBAR
		round(frame, IS_MOBILE and 4 or 6)

		local box = Instance.new("TextButton", frame)
		box.Size = UDim2.new(0, IS_MOBILE and 20 or 24, 0, IS_MOBILE and 20 or 24)
		box.Position = UDim2.new(1, IS_MOBILE and -24 or -30, 0, (h - (IS_MOBILE and 20 or 24)) / 2)
		box.BackgroundColor3 = default and COLOR_HIGHLIGHT or COLOR_BG
		box.Text = ""
		box.AutoButtonColor = false
		round(box, 4)
		table.insert(highlightActiveBoxes, box)

		local mark = Instance.new("Frame", box)
		mark.Size = UDim2.new(1, 0, 1, 0)
		mark.BackgroundColor3 = COLOR_BG
		mark.BackgroundTransparency = default and 1 or 0
		round(mark, 4)

		local lbl = Instance.new("TextLabel", frame)
		lbl.Text = text
		lbl.Font = Enum.Font.Gotham
		lbl.TextSize = IS_MOBILE and 11 or 14
		lbl.TextColor3 = COLOR_HIGHLIGHT
		lbl.BackgroundTransparency = 1
		lbl.Position = UDim2.new(0, IS_MOBILE and 6 or 8, 0, 0)
		lbl.Size = UDim2.new(1, IS_MOBILE and -32 or -38, 1, 0)
		lbl.TextXAlignment = Enum.TextXAlignment.Left
		lbl.TextScaled = IS_MOBILE
		table.insert(highlightTexts, lbl)

		box.MouseButton1Click:Connect(function()
			local on = not (mark.BackgroundTransparency == 1)
			mark.BackgroundTransparency = on and 1 or 0
			box.BackgroundColor3 = on and COLOR_HIGHLIGHT or COLOR_BG
			if cb then cb(on) end
		end)
		
		if default and cb then cb(true) end
		return h
	end

	local function isOn(labelText)
		for _, frame in ipairs(p:GetChildren()) do
			if frame:IsA("Frame") then
				local lbl = frame:FindFirstChildOfClass("TextLabel")
				local box = frame:FindFirstChildOfClass("TextButton")
				if lbl and box and lbl.Text == labelText then
					return box.BackgroundColor3 == COLOR_HIGHLIGHT
				end
			end
		end
		return false
	end

	local ph1 = makeCheckbox("Player ESP", false, y, function() end); y = y + ph1 + (IS_MOBILE and 6 or 8)
	local h1 = makeCheckbox("Animatronic ESP", false, y, function() end); y = y + h1 + (IS_MOBILE and 6 or 8)
	local h2 = makeCheckbox("Fuse ESP", false, y, function() end); y = y + h2 + (IS_MOBILE and 6 or 8)
	local h3 = makeCheckbox("Chest ESP", false, y, function() end); y = y + h3 + (IS_MOBILE and 6 or 8)
	local h4 = makeCheckbox("Screwdriver ESP", false, y, function() end); y = y + h4 + (IS_MOBILE and 6 or 8)
	local h5 = makeCheckbox("Camera ESP", false, y, function() end); y = y + h5 + (IS_MOBILE and 6 or 8)
	local h6 = makeCheckbox("Plier ESP", false, y, function() end); y = y + h6 + (IS_MOBILE and 6 or 8)

	local PESP_Normal = {}
	local PESP_Low = {}

	local skeletonPairsR15 = {
		{"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"}, {"LowerTorso", "HumanoidRootPart"},
		{"UpperTorso", "LeftUpperArm"}, {"LeftUpperArm", "LeftLowerArm"}, {"LeftLowerArm", "LeftHand"},
		{"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"}, {"RightLowerArm", "RightHand"},
		{"LowerTorso", "LeftUpperLeg"}, {"LeftUpperLeg", "LeftLowerLeg"}, {"LeftLowerLeg", "LeftFoot"},
		{"LowerTorso", "RightUpperLeg"}, {"RightUpperLeg", "RightLowerLeg"}, {"RightLowerLeg", "RightFoot"},
	}
	
	local skeletonPairsR6 = {
		{"Head", "Torso"}, {"Torso", "HumanoidRootPart"},
		{"Torso", "Left Arm"}, {"Left Arm", "Left Leg"},
		{"Torso", "Right Arm"}, {"Right Arm", "Right Leg"},
	}

	local function getPairs(char)
		return char:FindFirstChild("UpperTorso") and skeletonPairsR15 or skeletonPairsR6
	end

	local function ensureAttachment(part)
		if not part then return nil end
		local att = part:FindFirstChild("_EN_Att")
		if not att then
			att = Instance.new("Attachment")
			att.Name = "_EN_Att"
			att.Parent = part
		end
		return att
	end

	local function makeBeam(att0, att1, color)
		local beam = Instance.new("Beam")
		beam.FaceCamera = true
		beam.LightEmission = 1
		beam.Width0 = 0.08
		beam.Width1 = 0.08
		beam.Color = ColorSequence.new(color)
		beam.Attachment0 = att0
		beam.Attachment1 = att1
		beam.Parent = att0
		return beam
	end

	local function makeNameTag(adornPart, color)
		local gui = Instance.new("BillboardGui")
		gui.Size = UDim2.new(0, IS_MOBILE and 150 or 200, 0, IS_MOBILE and 18 or 22)
		gui.AlwaysOnTop = true
		gui.Name = "_EN_NameTag"
		gui.Adornee = adornPart
		local lbl = Instance.new("TextLabel", gui)
		lbl.BackgroundTransparency = 1
		lbl.Size = UDim2.new(1, 0, 1, 0)
		lbl.Font = Enum.Font.GothamBold
		lbl.TextSize = IS_MOBILE and 11 or 14
		lbl.TextColor3 = color
		lbl.TextStrokeTransparency = 0.4
		lbl.TextScaled = IS_MOBILE
		return gui, lbl
	end

	local function buildNormalESP(plr)
		if PESP_Normal[plr] then return end
		local char = plr.Character
		if not char then return end
		local hrp = char:FindFirstChild("HumanoidRootPart")
		if not hrp then return end

		local gui, lbl = makeNameTag(hrp, Color3.fromRGB(255, 255, 255))
		gui.Parent = screenGui

		local hl = Instance.new("Highlight")
		hl.FillTransparency = 1
		hl.OutlineColor = Color3.fromRGB(0, 170, 255)
		hl.OutlineTransparency = 0
		hl.Adornee = char
		hl.Parent = screenGui

		local beams, atts = {}, {}
		for _, pair in ipairs(getPairs(char)) do
			local a = char:FindFirstChild(pair[1])
			local b = char:FindFirstChild(pair[2])
			if a and b and a:IsA("BasePart") and b:IsA("BasePart") then
				local attA = ensureAttachment(a)
				local attB = ensureAttachment(b)
				if attA and attB then
					local beam = makeBeam(attA, attB, Color3.fromRGB(0, 170, 255))
					table.insert(beams, beam)
					atts[pair[1]] = attA
					atts[pair[2]] = attB
				end
			end
		end

		PESP_Normal[plr] = { tagGui = gui, tagLabel = lbl, highlight = hl, beams = beams, atts = atts }
	end

	local function cleanupNormalESP(plr)
		local data = PESP_Normal[plr]
		if not data then return end
		if data.tagGui then data.tagGui:Destroy() end
		if data.highlight then data.highlight:Destroy() end
		if data.beams then for _, b in ipairs(data.beams) do pcall(function() b:Destroy() end) end end
		PESP_Normal[plr] = nil
	end

	local function buildLowESP(plr)
		if PESP_Low[plr] then return end
		local char = plr.Character
		if not char then return end
		local hrp = char:FindFirstChild("HumanoidRootPart")
		if not hrp then return end

		local gui, lbl = makeNameTag(hrp, Color3.fromRGB(255, 255, 255))
		gui.Parent = screenGui

		local hl = Instance.new("Highlight")
		hl.FillTransparency = 1
		hl.OutlineColor = Color3.fromRGB(255, 255, 0)
		hl.OutlineTransparency = 0
		hl.Adornee = char
		hl.Parent = screenGui

		PESP_Low[plr] = { tagGui = gui, tagLabel = lbl, highlight = hl }
	end

	local function cleanupLowESP(plr)
		local data = PESP_Low[plr]
		if not data then return end
		if data.tagGui then data.tagGui:Destroy() end
		if data.highlight then data.highlight:Destroy() end
		PESP_Low[plr] = nil
	end

	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			plr.CharacterAdded:Connect(function() cleanupNormalESP(plr); cleanupLowESP(plr) end)
			plr.CharacterRemoving:Connect(function() cleanupNormalESP(plr); cleanupLowESP(plr) end)
		end
	end
	
	Players.PlayerRemoving:Connect(function(plr) cleanupNormalESP(plr); cleanupLowESP(plr) end)

	local lastPlayerNormalUpdate = 0
	local lastPlayerLowUpdate = 0

	RunService.RenderStepped:Connect(function()
		local char = LocalPlayer.Character
		local hrp = char and char:FindFirstChild("HumanoidRootPart")
		if not hrp then return end

		if isOn("Animatronic ESP") then
			for m, d in pairs(activeESP) do
				local ok = m and d.part
				d.gui.Enabled = ok
				if ok then
					local dist = (d.part.Position - hrp.Position).Magnitude
					d.label.Text = string.format("%s | %dm", m.Name, math.floor(dist))
					if d.glow then d.glow.Enabled = true end
				elseif d.glow then
					d.glow.Enabled = false
				end
			end
		else
			for _, d in pairs(activeESP) do
				d.gui.Enabled = false
				if d.glow then d.glow.Enabled = false end
			end
		end

		local function updateSet(tbl, enabled, nameText)
			for _, d in pairs(tbl) do
				local ok = d.part
				d.gui.Enabled = enabled and ok or false
				if enabled and ok then
					local dist = (d.part.Position - hrp.Position).Magnitude
					d.label.Text = string.format("%s | %dm", nameText, math.floor(dist))
					if d.glow then d.glow.Enabled = true end
				else
					if d.glow then d.glow.Enabled = false end
				end
			end
		end

		updateSet(fuseESP, isOn("Fuse ESP"), "Fuse")
		updateSet(chestESP, isOn("Chest ESP"), "Bau")
		updateSet(plierESP, isOn("Plier ESP"), "Pliers")
		updateSet(cameraESP, isOn("Camera ESP"), "Camera")
		updateSet(screwESP, isOn("Screwdriver ESP"), "Screwdriver")

		if isOn("Player ESP") then
			if tick() - lastPlayerNormalUpdate >= (1 / 30) then
				lastPlayerNormalUpdate = tick()
				local lpos = hrp.Position
				for _, plr in ipairs(Players:GetPlayers()) do
					if plr ~= LocalPlayer then
						if not PESP_Normal[plr] then buildNormalESP(plr) end
						local data = PESP_Normal[plr]
						if data then
							local c = plr.Character
							local phrp = c and c:FindFirstChild("HumanoidRootPart")
							if c and phrp then
								data.tagGui.Enabled = true
								local dist = (phrp.Position - lpos).Magnitude
								data.tagLabel.Text = string.format("%s | %dm", plr.Name, math.floor(dist))
								if data.highlight then data.highlight.Enabled = true end
							else
								data.tagGui.Enabled = false
								if data.highlight then data.highlight.Enabled = false end
							end
						end
					end
				end
			end
		else
			for plr, _ in pairs(PESP_Normal) do
				cleanupNormalESP(plr)
			end
		end
	end)
end

-- Misc Page with mobile-responsive controls
do
	local p = scrolls.Misc
	local y = IS_MOBILE and 8 or 16

	local function makeCheckbox(text, default, yPos, cb)
		local h = IS_MOBILE and 28 or 30
		local frame = Instance.new("Frame", p)
		frame.Size = UDim2.new(1, IS_MOBILE and -16 or -32, 0, h)
		frame.Position = UDim2.new(0, IS_MOBILE and 8 or 16, 0, yPos)
		frame.BackgroundColor3 = COLOR_SIDEBAR
		round(frame, IS_MOBILE and 4 or 6)

		local box = Instance.new("TextButton", frame)
		box.Size = UDim2.new(0, IS_MOBILE and 20 or 24, 0, IS_MOBILE and 20 or 24)
		box.Position = UDim2.new(1, IS_MOBILE and -24 or -30, 0, (h - (IS_MOBILE and 20 or 24)) / 2)
		box.BackgroundColor3 = default and COLOR_HIGHLIGHT or COLOR_BG
		box.Text = ""
		box.AutoButtonColor = false
		round(box, 4)
		table.insert(highlightActiveBoxes, box)

		local mark = Instance.new("Frame", box)
		mark.Size = UDim2.new(1, 0, 1, 0)
		mark.BackgroundColor3 = COLOR_BG
		mark.BackgroundTransparency = default and 1 or 0
		round(mark, 4)

		local lbl = Instance.new("TextLabel", frame)
		lbl.Text = text
		lbl.Font = Enum.Font.Gotham
		lbl.TextSize = IS_MOBILE and 11 or 14
		lbl.TextColor3 = COLOR_HIGHLIGHT
		lbl.BackgroundTransparency = 1
		lbl.Position = UDim2.new(0, IS_MOBILE and 6 or 8, 0, 0)
		lbl.Size = UDim2.new(1, IS_MOBILE and -32 or -38, 1, 0)
		lbl.TextXAlignment = Enum.TextXAlignment.Left
		lbl.TextScaled = IS_MOBILE
		table.insert(highlightTexts, lbl)

		box.MouseButton1Click:Connect(function()
			local on = not (mark.BackgroundTransparency == 1)
			mark.BackgroundTransparency = on and 1 or 0
			box.BackgroundColor3 = on and COLOR_HIGHLIGHT or COLOR_BG
			if cb then cb(on) end
		end)
		
		if default and cb then cb(true) end
		return h, frame, box
	end

	local function makeSlider(text, min, max, default, yPos, callback)
		local h = IS_MOBILE and 35 or 30
		local frame = Instance.new("Frame", p)
		frame.Size = UDim2.new(1, IS_MOBILE and -16 or -32, 0, h)
		frame.Position = UDim2.new(0, IS_MOBILE and 8 or 16, 0, yPos)
		frame.BackgroundColor3 = COLOR_SIDEBAR
		round(frame, IS_MOBILE and 4 or 6)

		local lbl = Instance.new("TextLabel", frame)
		lbl.Text = (text .. ": " .. tostring(default))
		lbl.Font = Enum.Font.Gotham
		lbl.TextSize = IS_MOBILE and 11 or 14
		lbl.TextColor3 = COLOR_HIGHLIGHT
		lbl.BackgroundTransparency = 1
		lbl.Position = UDim2.new(0, IS_MOBILE and 6 or 8, 0, 0)
		lbl.Size = UDim2.new(1, 0, 0, IS_MOBILE and 14 or 16)
		lbl.TextXAlignment = Enum.TextXAlignment.Left
		lbl.TextScaled = IS_MOBILE
		table.insert(highlightTexts, lbl)

		local bg = Instance.new("Frame", frame)
		bg.Size = UDim2.new(1, IS_MOBILE and -12 or -16, 0, IS_MOBILE and 6 or 8)
		bg.Position = UDim2.new(0, IS_MOBILE and 6 or 8, 0, IS_MOBILE and 22 or 20)
		bg.BackgroundColor3 = COLOR_BG
		round(bg, 4)

		local fill = Instance.new("Frame", bg)
		fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
		fill.BackgroundColor3 = COLOR_HIGHLIGHT
		round(fill, 4)
		table.insert(sliderFills, fill)

		local function update(x)
			local rel = math.clamp(x - bg.AbsolutePosition.X, 0, bg.AbsoluteSize.X)
			local v = math.floor(min + (rel / bg.AbsoluteSize.X) * (max - min) + 0.5)
			lbl.Text = text .. ": " .. v
			fill.Size = UDim2.new((v - min) / (max - min), 0, 1, 0)
			if callback then callback(v) end
		end
		
		bg.InputBegan:Connect(function(i)
			if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
				update(i.Position.X)
				local conn = UserInputService.InputChanged:Connect(function(m)
					if m.UserInputType == Enum.UserInputType.MouseMovement or m.UserInputType == Enum.UserInputType.Touch then
						update(m.Position.X)
					end
				end)
				UserInputService.InputEnded:Connect(function(e)
					if e.UserInputType == Enum.UserInputType.MouseButton1 or e.UserInputType == Enum.UserInputType.Touch then
						conn:Disconnect()
					end
				end)
			end
		end)

		return h
	end

	local _, _, clockBtn = makeCheckbox("Show Clock Time", true, y, function() end); y = y + (IS_MOBILE and 34 or 38)
	local _, _, puppBtn = makeCheckbox("Show Puppet Timer", true, y, function() end); y = y + (IS_MOBILE and 34 or 38)
	local _, _, stamBtn = makeCheckbox("Infinite Stamina", false, y, function(on)
		pcall(function()
			game:GetService("ReplicatedStorage").GameSettings.Coisas.Stamina.Infinity.Value = on and true or false
		end)
	end); y = y + (IS_MOBILE and 34 or 38)

	local _, _, noclipB = makeCheckbox("Noclip", false, y, function() end); y = y + (IS_MOBILE and 34 or 38)
	local _, _, brightB = makeCheckbox("Full Bright", false, y, function() end); y = y + (IS_MOBILE and 34 or 38)

	local hApproach, _, approachBtn = makeCheckbox("Animatronic Approach Alert", false, y, function(enabled)
		if enabled then
			showNotification("Proximity Alert", "Animatronic tracking activated.", "success", 3)
		else
			showNotification("Proximity Alert", "Animatronic tracking disabled.", "warning", 3)
		end
	end)
	y = y + hApproach + (IS_MOBILE and 6 or 8)

	do
		local RANGE = 12
		local COOLDOWN = 5
		local lastTrig = {}

		local checkPoints = {
			{pos = Vector3.new(-175.09, 3.85, 137.31), name = "Right Door (Vent)"},
			{pos = Vector3.new(-175.02, 3.85, 95.37), name = "Right Door (Power)"},
			{pos = Vector3.new(-243.49, 3.85, 128.49), name = "Left Door"},
			{pos = Vector3.new(-208.48, 3.85, 79.06), name = "Main Entrance"},
		}

		task.spawn(function()
			while screenGui.Parent do
				local toggleOn = (approachBtn and approachBtn.BackgroundColor3 == COLOR_HIGHLIGHT)

				if toggleOn then
					local animFolder = safeFind({"Game", "Animatronics", "Animatronics"})
					if animFolder then
						for _, anim in ipairs(animFolder:GetChildren()) do
							if anim:IsA("Model") and anim:FindFirstChild("HumanoidRootPart") then
								local animPos = anim.HumanoidRootPart.Position

								for i, cp in ipairs(checkPoints) do
									local dist = (animPos - cp.pos).Magnitude

									if dist <= RANGE then
										local now = tick()
										if not lastTrig[i] or (now - lastTrig[i]) > COOLDOWN then
											lastTrig[i] = now
											showNotification(
												"Warning",
												string.format("%s is approaching the %s!", anim.Name, cp.name),
												"error",
												3
											)
										end
									end
								end
							end
						end
					end
				end

				task.wait(0.5)
			end
		end)
	end

	local _, _, alwaysWinT = makeCheckbox("Always Win", false, y, function(state)
		local targetPos = Vector3.new(6.50, 115.82, 129.34)
		local c = LocalPlayer.Character
		if not c or not c:FindFirstChild("HumanoidRootPart") then return end
		local hrp = c.HumanoidRootPart

		if state then
			alwaysWinLastPos = hrp.Position
			if isAnimatronicNearPosition(targetPos) then
				warn("[TP Blocked] Animatronic near Always Win location!")
				return
			end
			hrp.CFrame = CFrame.new(targetPos)
		else
			if alwaysWinLastPos then
				if isAnimatronicNearPosition(alwaysWinLastPos) then
					warn("[TP Blocked] Animatronic near return position!")
					return
				end
				hrp.CFrame = CFrame.new(alwaysWinLastPos)
			end
		end
	end); y = y + (IS_MOBILE and 34 or 38)

	makeSlider("WalkSpeed", 10, 100, 16, y, function(speed)
		pcall(function()
			local s = ReplicatedStorage.GameSettings.Coisas.Stamina.RunSpeed
			s.Value = speed
		end)
	end); y = y + (IS_MOBILE and 41 or 40)

	local clockLabel = Instance.new("TextLabel", screenGui)
	clockLabel.Position = UDim2.new(0.5, IS_MOBILE and -75 or -100, 0, IS_MOBILE and 5 or 10)
	clockLabel.Size = UDim2.new(0, IS_MOBILE and 150 or 200, 0, IS_MOBILE and 25 or 30)
	clockLabel.BackgroundTransparency = 1
	clockLabel.Font = Enum.Font.GothamBold
	clockLabel.TextSize = IS_MOBILE and 16 or 22
	clockLabel.TextColor3 = Color3.new(1, 1, 1)
	clockLabel.TextStrokeTransparency = 0.5
	clockLabel.Text = "Clock | 00:00"
	clockLabel.TextScaled = IS_MOBILE

	local puppetLabel = Instance.new("TextLabel", screenGui)
	puppetLabel.Position = UDim2.new(0.5, IS_MOBILE and -75 or -100, 0, IS_MOBILE and 32 or 45)
	puppetLabel.Size = UDim2.new(0, IS_MOBILE and 150 or 200, 0, IS_MOBILE and 20 or 25)
	puppetLabel.BackgroundTransparency = 1
	puppetLabel.Font = Enum.Font.GothamBold
	puppetLabel.TextSize = IS_MOBILE and 14 or 18
	puppetLabel.TextColor3 = Color3.new(0, 1, 0)
	puppetLabel.TextStrokeTransparency = 0.5
	puppetLabel.Text = "Timer | Puppet: 100"
	puppetLabel.TextScaled = IS_MOBILE

	local puppetSilencedAtZero = false

	task.spawn(function()
		while task.wait(1) do
			local ok, err = pcall(function()
				local settings = ReplicatedStorage:WaitForChild("GameSettings"):WaitForChild("Coisas")
				local minutes = settings.ClockTime.Minutes.Value
				local seconds = settings.ClockTime.Seconds.Value
				local puppet = settings.Puppet.MusicBox.Value

				clockLabel.Visible = (clockBtn.BackgroundColor3 == COLOR_HIGHLIGHT)
				puppetLabel.Visible = (puppBtn.BackgroundColor3 == COLOR_HIGHLIGHT)

				if clockLabel.Visible then
					clockLabel.Text = string.format("%02d:%02d", minutes, seconds)
				end

				if puppetLabel.Visible then
					puppetLabel.Text = "Puppet: " .. math.floor(puppet)
					puppetLabel.TextColor3 = puppet < 25 and Color3.new(1, 0, 0) or Color3.new(0, 1, 0)

					if puppet <= 0 then
						puppetSilencedAtZero = true
						puppetWarned = false
						lastPuppetBeep = time()
					elseif puppet < 25 then
						if puppetSilencedAtZero then
							puppetSilencedAtZero = false
							puppetWarned = false
							lastPuppetBeep = time()
						end

						if not puppetWarned then
							puppetWarned = true
							PlayWarnSound(0.6, 1.15)
							showNotification("Warning", "Puppet timer is below 25%!", "error", 3)
							lastPuppetBeep = time()
						end

						if time() - lastPuppetBeep >= BEEP_COOLDOWN then
							PlayWarnSound(0.6, 1.15)
							lastPuppetBeep = time()
						end
					elseif puppet >= 30 then
						puppetWarned = false
						puppetSilencedAtZero = false
					end
				end
			end)
			if not ok then
				warn("[PuppetLoop] ", err)
			end
		end
	end)

	task.spawn(function()
		local saved = {
			Brightness = Lighting.Brightness,
			ClockTime = Lighting.ClockTime,
			FogEnd = Lighting.FogEnd,
			GlobalShadows = Lighting.GlobalShadows,
			Ambient = Lighting.Ambient,
			OutdoorAmbient = Lighting.OutdoorAmbient
		}
		while task.wait(0.5) do
			if brightB.BackgroundColor3 == COLOR_HIGHLIGHT then
				pcall(function()
					Lighting.Brightness = 3
					Lighting.ClockTime = 12
					Lighting.FogEnd = 100000
					Lighting.GlobalShadows = false
					Lighting.Ambient = Color3.new(1, 1, 1)
					Lighting.OutdoorAmbient = Color3.new(1, 1, 1)
				end)
			else
				pcall(function()
					for k, v in pairs(saved) do Lighting[k] = v end
				end)
			end
		end
	end)

	task.spawn(function()
		while task.wait() do
			if noclipB.BackgroundColor3 == COLOR_HIGHLIGHT and LocalPlayer.Character then
				for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
					if part:IsA("BasePart") then part.CanCollide = false end
				end
			end
		end
	end)
end

-- Teleport Page with mobile-responsive buttons
do
	local p = scrolls.TP
	local y = IS_MOBILE and 8 or 16
	
	local function makeButton(text, yPos, cb)
		local btn = Instance.new("TextButton", p)
		btn.Text = text
		btn.Font = Enum.Font.GothamBold
		btn.TextSize = IS_MOBILE and 12 or 16
		btn.TextColor3 = COLOR_HIGHLIGHT
		btn.BackgroundColor3 = COLOR_SIDEBAR
		btn.Size = UDim2.new(1, IS_MOBILE and -16 or -32, 0, IS_MOBILE and 32 or 30)
		btn.Position = UDim2.new(0, IS_MOBILE and 8 or 16, 0, yPos)
		btn.TextScaled = IS_MOBILE
		round(btn, IS_MOBILE and 4 or 6)
		table.insert(highlightTexts, btn)
		btn.MouseButton1Click:Connect(cb)
		return IS_MOBILE and 32 or 30
	end

	y = y + makeButton("TP → Power Facility", y, function()
		local targetPos = Vector3.new(-83.09, 3.40, 150.32)
		if isAnimatronicNearPosition(targetPos) then
			showNotification("Teleport", "Blocked: animatronic nearby", "error", 2)
			return
		end
		local c = LocalPlayer.Character
		if c and c:FindFirstChild("HumanoidRootPart") then
			c.HumanoidRootPart.CFrame = CFrame.new(targetPos)
		end
	end) + (IS_MOBILE and 6 or 8)

	y = y + makeButton("TP → Puppet", y, function()
		local targetPos = Vector3.new(-112.30, 3.87, -11.96)
		if isAnimatronicNearPosition(targetPos) then
			showNotification("Teleport", "Blocked: animatronic nearby", "error", 2)
			return
		end
		local c = LocalPlayer.Character
		if c and c:FindFirstChild("HumanoidRootPart") then
			c.HumanoidRootPart.CFrame = CFrame.new(targetPos)
		end
	end) + (IS_MOBILE and 6 or 8)

	y = y + makeButton("TP → Office", y, function()
		local targetPos = Vector3.new(-208.54, 3.85, 153.47)
		if isAnimatronicNearPosition(targetPos) then
			showNotification("Teleport", "Blocked: animatronic nearby", "error", 2)
			return
		end
		local c = LocalPlayer.Character
		if c and c:FindFirstChild("HumanoidRootPart") then
			c.HumanoidRootPart.CFrame = CFrame.new(targetPos)
		end
	end) + (IS_MOBILE and 6 or 8)

	y = y + makeButton("TP → Fuse To You", y, function()
		task.spawn(function()
			local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
			local hrp = char:WaitForChild("HumanoidRootPart")
			for _, v in pairs(workspace:GetChildren()) do
				if v:IsA("Tool") and v.Name == "Fuse" and v:FindFirstChild("Handle") then
					v.Handle.CFrame = hrp.CFrame + Vector3.new(math.random(-2, 2), 0, math.random(-2, 2))
					task.wait(1)
				end
			end
		end)
	end) + (IS_MOBILE and 6 or 8)

	y = y + makeButton("TP → Screwdriver To You", y, function()
		task.spawn(function()
			local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
			local hrp = char:WaitForChild("HumanoidRootPart")
			for _, v in pairs(workspace:GetChildren()) do
				if v:IsA("Tool") and v.Name == "Phillips screwdriver" and v:FindFirstChild("Handle") then
					v.Handle.CFrame = hrp.CFrame + Vector3.new(math.random(-2, 2), 0, math.random(-2, 2))
					task.wait(1)
				end
			end
		end)
	end) + (IS_MOBILE and 6 or 8)

	y = y + makeButton("TP → Photo Camera To You", y, function()
		task.spawn(function()
			local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
			local hrp = char:WaitForChild("HumanoidRootPart")
			for _, v in pairs(workspace:GetChildren()) do
				if v:IsA("Tool") and v.Name == "Photo Camera" and v:FindFirstChild("Handle") then
					v.Handle.CFrame = hrp.CFrame + Vector3.new(math.random(-2, 2), 0, math.random(-2, 2))
					task.wait(1)
				end
			end
		end)
	end) + (IS_MOBILE and 6 or 8)

	y = y + makeButton("TP → Plier To You", y, function()
		task.spawn(function()
			local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
			local hrp = char:WaitForChild("HumanoidRootPart")
			for _, v in pairs(workspace:GetChildren()) do
				if v:IsA("Tool") and v.Name == "Pliers" and v:FindFirstChild("Handle") then
					v.Handle.CFrame = hrp.CFrame + Vector3.new(math.random(-2, 2), 0, math.random(-2, 2))
					task.wait(1)
				end
			end
		end)
	end) + (IS_MOBILE and 6 or 8)

	y = y + makeButton("TP → All Coins To You", y, function()
		task.spawn(function()
			local char = LocalPlayer.Character
			if not char or not char:FindFirstChild("HumanoidRootPart") then
				showNotification("Coin TP", "Character not found", "error", 2)
				return
			end
			local hrp = char.HumanoidRootPart
			local coinsFolder = workspace:FindFirstChild("Map") and workspace.Map:FindFirstChild("CoinsMap")
			if not coinsFolder then
				showNotification("Coin TP", "CoinsMap folder not found", "error", 2)
				return
			end
			for _, coin in pairs(coinsFolder:GetChildren()) do
				if coin:IsA("BasePart") or coin:IsA("MeshPart") then
					coin.CFrame = hrp.CFrame + Vector3.new(math.random(-2, 2), 0, math.random(-2, 2))
					task.wait(1)
				end
			end
		end)
	end) + (IS_MOBILE and 6 or 8)
end

showPage("Main")
RunService.Heartbeat:Connect(function() refreshUI() end)

-- Mobile-friendly toggle key (M key or touch menu button)
UserInputService.InputBegan:Connect(function(i, g)
	if not g and i.KeyCode == Enum.KeyCode.M then
		screenGui.Enabled = not screenGui.Enabled
	end
end)

-- Mobile toggle button (optional - appears on screen)
if IS_MOBILE then
	local toggleBtn = Instance.new("TextButton", screenGui)
	toggleBtn.Text = "☰"
	toggleBtn.Font = Enum.Font.GothamBold
	toggleBtn.TextSize = 24
	toggleBtn.TextColor3 = COLOR_HIGHLIGHT
	toggleBtn.BackgroundColor3 = COLOR_BG
	toggleBtn.Size = UDim2.new(0, 45, 0, 45)
	toggleBtn.Position = UDim2.new(0, 10, 0, 10)
	toggleBtn.ZIndex = 10
	round(toggleBtn, 8)
	
	toggleBtn.MouseButton1Click:Connect(function()
		main.Visible = not main.Visible
	end)
end

local payload = [[loadstring(game:HttpGet("https://raw.githubusercontent.com/Snipez-Dev/Rbx-Scripts/refs/heads/main/Eternal%20Nights"))()]]

local function try_queue(code)
	if syn and syn.queue_on_teleport then
		syn.queue_on_teleport(code)
	elseif queue_on_teleport then
		queue_on_teleport(code)
	elseif secure_queue_on_teleport then
		secure_queue_on_teleport(code)
	elseif exploit and exploit.queue_on_teleport then
		exploit.queue_on_teleport(code)
	else
		warn("[QueueOnTeleport] queue_on_teleport not supported in this executor.")
		return
	end
end

try_queue(payload)

-- Mobile optimization notification
if IS_MOBILE then
	showNotification("Mobile Mode", "UI optimized for " .. (IS_TABLET and "tablet" or "mobile") .. " device", "success", 3)
end
